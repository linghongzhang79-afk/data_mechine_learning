# 机器学习课程设计项目报告——project 2

## 1. 项目基本信息
- 小组编号：111
- 课题名称：日本东京民宿月度动态分析与核心指标预测（课题二：月度动态）
- 选定城市及范围：Tokyo（单一城市详细分析）
- 选定时间范围：2024.12–2025.11（使用全部可用数据）
- 所用数据表：（data/processed：数据清理后），（data/raw：数据清理前）
> - **Listings表:Listings Data.csv ， Calendar Rates表: Past Calendar Rates.csv**
> - **处理后可用的聚合表格：full_cleaned_data.csv**
> - **小市场需求筛选的月度聚合表格：full_monthly_market_data.csv**
- 项目 Github 仓库地址：https://github.com/ZJUT-CS/ml-course-project-2025-111.git

### 1.1 小组成员与角色分工（固定 4 人）

> 建议角色：  
> - **EDA 负责人**：整体探索分析与可视化  
> - **建模负责人**：特征工程与模型选择调参  
> - **代码负责人**：项目结构、数据处理与训练脚本、可复现性  
> - **展示与写作负责人**：汇总结论、PPT、报告撰写与润色  

| 成员   | 姓名  | 学号           | GitHub 用户名           | 主要负责内容（简要）                               |
|--------|------|--------------|----------------------|------------------------------------------|
| 学生 1 | 褚欣怡 | 302023562004 | cxy6125              | 建模：初步完成两个模型创立  ；代码：实现数据处理划分探索            |
| 学生 2 | 邓文惠 | 302023562032 | Augenstern-star1     | EDA:部分EDA分析与可视化实现；展示与写作：项目报告、PPt实现框架基础内容 |
| 学生 3 | 蒋政洋 | 302023562010 | AKAYang123AKAYang123 | 多变量时间序列预测模型（VAR/XGBoost）构建与策略分析结论总结，报告撰写 |
| 学生 4 | 蒋靖豪 | 302023562059 | jinghao-jiang        | EDA:数据清洗与合并，市场调整；建模：                     |

---------

## 2. 问题背景与数据集说明

### 2.1 业务背景与研究问题
- 2.1.1 业务背景：
- Airbnb 短租市场在东京呈现显著的月度波动特征，经我们小组实际数据分析验证，发现引发波动可能的核心影响因素仅聚焦于两大节假日，同时加上房源自身不同
- 情况导致的差异， 这些都一起导致了房东面临入住率不稳定、定价不合理等经营难题。 
- 节假日因素（我们小组分析针对的 2 类）： 
- 1、樱花季（3-4 月）    2、元旦假期（12 月 25 日 - 1 月 5 日）
- 非节假日因素（房源自身原因）： 
- 1、基础属性：超赞房东标识、房型（整套公寓 / 单间）、卧室数量、所在街区（核心商圈 / 非核心商圈）； 
- 2、运营属性：定价水平、设施配置、价格溢价能力；


- 2.1.2 核心问题：
- 任  务：
- 1、分析任务：挖掘东京民宿市场月度变化规律，重点识别樱花季、元旦两大节假日及房源自身属性对核心收益指标的作用机制；
- 2、预测任务（双目标回归任务）：基于历史数据预测未来6个月（2026.01~2026.06）的民宿月度核心指标，为房东提前制定定价与库存策略提供依据；

- 目标变量：
- 1、月度平均入住率（occupancy，单位：%）：当月民宿已预订天数占可售天数的百分比。反映民宿需求与运营状况。
- 2、月度平均房价（rate_avg，单位：日元 / 晚）：当月民宿每日房价出售的算术平均值。反映民宿定价水平与收益能力。
- 3、月度收益（=月度平均房价×月度平均入住率×当月可售天数），用于界定 “高收益房源”（按收益分位数 Top20% 界定）。

- 2.1.3 研究价值：
- 精准挖掘这两大节假日及房源属性对民宿的影响规律，并预测月度动态变化，做出未来预测
- 1、为平台优化房源曝光规则； 
- 2、帮助房东科学化的优化定价策略，从而提升自己房屋的入住率与收益； 
- 3、为后续民宿市场研究提供数据分析，房客也能更好掌握信息选择自己的目标房子。

### 2.2 数据来源与筛选规则

- 数据来源：AirROI数据集中“Tokyo,Japan”，https://www.airroi.com/data-portal/markets/tokyo-japan

- 所使用的数据表及其作用：
  - Listings Data：房源基础信息核心表，包含listing_id、listing_type、room_type、superhost等静态属性+ 近 90 天 / 过去一年表现字段。
  - Past Calendar Rates：2024-2025 年每日动态数据核心表，包含日期date、收益 revenue、原价 rate_avg、预订价 booked_rate_avg、平均预定入住天数booking_lead_time_avg等
  - 数据，用于计算未来的入住率（occupancy）、价格溢价（price_premium）、预订提前期（booking_lead_time_avg）等动态指标。
  
- 样本量与筛选条件：
  - 初始样本量（各表的大致行数即可）：Calendar数据形状: (3565, 14) ， Listings数据形状: (298, 62)
  - 筛选规则（例如：限定城市、去除缺失严重样本、过滤极端值等）。
  - 1、City：日本东京的房源，
  - 2、子市场：room_type = 'entire_home' (整租房源) ，guests在2-4人之间
  - 3、缺失值：
  -    a、去除 Listings 表中房源 ID、房型listing_type、超赞房东标识superhost等核心字段缺失的样本，无法补回，可以保证完整性
  -    b、“业务办理”数值型：occupancy=0时，对应元组的“业务办理”所有属性缺失值都填充0；反之，都用对应属性的中位数填充
  -    c、“收入财务”数值型（如"revenue", "native_revenue"）：无收入时缺失值都填充为0
  -    d、其他数值型都用中位数填充。注，occupancy的值一定是[0,1]
  -    e、类别型（如"professional_management"）：缺失值都用众数填充
  - 4、过滤：（IQR方法判断）
  -   a、过滤 Calendar Rates 表中revenue价格异常值，界限[IQR最低价，IQR最高价]，超出界限判定异常修正为贴近的合理范围
  -   b、过滤 occupancy 数值范围超出正常的[0,1]区间的比例数，使用IQR缩尾
  -   c、revenue等收入值，还有其他的无关变量实际不能为负数的，使用IQR缩尾

- 核心特征说明：
  - 列举 8–15 个本项目最重要的字段，并简单说明含义与预期影响（例如：`bedrooms`、`rating_location`、`ttm_revpar` 等）。
  - 1、occupancy(数值型)：
  -   入住率，计算公式为 “已预订天数 / 可售天数”，取值范围 0-1 。0 = 无入住，1 = 满房
  -   分析并进行未来预测的指标，可以直接决定房源收益revenue大小。同时还可以反映出，市场上该房源的需求量大小，数值越高说明房源越受欢迎
  - 2、rate_avg（数值型）：
  -   房源每日平均出售的原价，单位是 日元 / 晚
  -   后续eda处理相关性使用，发现与收益revenue呈非线性正相关，与入住率occupancy呈弱负相关（价格过高会抑制需求）
  - 3、reserved_days（数值型）：
  -   已预订天数，房源在统计的时间内被成功预订的总天数
  -   与入住率occupancy强正相关。预订天数越多，入住率越高，就可以直接推动单个房源情况下累计收益增长。特殊季节如樱花季的时候显著偏高，更为明显
  - 4、vacant_days（数值型）：
  -   空置天数，出房源可售但是却未被预订的总天数
  -   与入住率occupancy强负相关，空置天数越少，入住率就越高，房源收益稳定性越强。淡季该值通常大幅增加
  - 5、revenue（数值型）：
  -   房源总收益，计算公式为 “booked_rate_avg × reserved_days”
  -   与入住率occupancy强正相关，入住率越高，总收益会越高。可以衡量房源盈利能力，制定更好的出售价格
  - 6、booked_rate_avg（数值型）：
  -   房源平均预订价（实际成交价），单位是 日元 / 晚
  -   该定价价值越高，单晚收益越高。但是相应的入住率occupancy也会变，所有需结合入住率平衡，避免高价导致预订量下滑
  - 7、booking_lead_time_avg（数值型）：
  -   平均预订的提前期，指 “预订日期与入住日期” 的间隔天数均值
  -   与入住率occupancy是正相关，表示提前期越长，那么预期入住率越高，因为房源热度高，定的人更多更需要。特殊季节如樱花季该值可达60天以上
  - 8、native_revenue（数值型）：
  -   本土客源总收益，计算公式为 “native_booked_rate_avg × 本土预订天数”
  -   与本土客源入住率呈现强正相关，该值越高，说明本土需求旺盛，房源收益不会随特殊季节性或者节假日等特殊时间产生较大波动，因为本土需求更稳定
  - 9、date（时间型）：
  -   数据规定形式，对应日期（YYYY-MM-DD），用于提取季节、月度 / 樱花季等时间特征
  -   决定房源季节性波动，比如我们研究的3-4 月（樱花季）、12 月（元旦）的入住率与收益呈 “双峰值”特征


### 2.3 预期目标与分析思路
- 预期输出：
  - 完成原始数据的全过程清洗，得出data文件中的如 full_cleaned_data.csv等的 4 个无空值、无异常的高质量数据集；
  - 通过 EDA 挖掘2024-2025年日本东京Tokoyo 民宿的月度淡旺季规律等的影响，输出full_eda_summary_report.txt总结数据处理过程中的结果；
  - 构建模型预测未来 6 个月的月度入住率与房价，生成forecast_summary_report.txt记录结果；
  
- 技术路径： 
  - 数据整合与清洗（Data Cleaning）：首先对 Listings 和 Calendar 原始表进行多表关联，利用业务逻辑填充缺失值，并通过 IQR 缩尾法消除异常波动，构建平稳的时间序列。 
  - 探索性分析（EDA）：运用统计学描述和可视化手段分析淡旺季规律，计算价格弹性系数，挖掘影响入住率的核心变量。 
  - 建模与预测（Modeling）：对比统计学模型（SARIMA）、深度学习框架（Prophet）以及机器学习算法（XGBoost），通过消融实验选定最优参数进行多维度预测。 
  - 决策支撑与解释（Interpretation）：将模型预测值转化为业务建议，通过模拟不同降价策略下的收益变化，最终形成可落地的市场分析报告。

---

## 3. 方法与模型设计

### 3.1 数据预处理与特征工程

- 缺失值处理方式（删除 / 填补 / 单独编码等）：
- 1、数值型特征（如occupancy、rate_avg、booking_lead_time_avg、length_of_stay_avg、native_booked_rate_avg）：
-   先分组再填充策略。先按“年 + 月分组”，计算的均值填充存在组内缺失值的地方，剩余未填充的空值部分用该字段全局中位数填补，确保无残留空值； 
- 2、类别型特征（如superhost、room_type、professional_management）：
-   采用众数填充，若众数不存在则填充为 “Unknown”，保证类别特征的完整性；
- 3、文本型特征（如listing_type、neighborhood）：
-   因为内容是特殊的存在，所以对所有该属性缺失值，统一填充为 “Unknown”，避免影响后续操作

- 异常值处理（价格、RevPAR 等的截断规则或变换）。
- 1、核心指标（如occupancy、rate_avg、revenue）：
-   采用 IQR 法计算出对应属性的上线与下限，超出的部分就是异常值。同时因为具体原因现实，添加业务合理下限约束，如入住率≥0、房价≥0、收入≥0，避免理论IQR计算得到负数；
- 2、极端异常值（如房价 > 15000 日元，上四分位数为界限，超出即不合理范围数值）：
-   采用截断法处理，限制合理区间范围，将超过合理区间的数值替换为靠近界限一边的值，让数据分布合理，避免极端值整体计算分析

- 特征工程：
- 1、类别变量：superhost，使用True/False布尔型的二元特征，True 转为 1，False 转为 0
- 2、派生特征：
-   a、每月活跃房源数，按年月分组后在文件full_monthly_market_data.csv中，记录为属性为listing_id的数
-   b、occupancy入住率= reserved_days / (reserved_days + vacant_days)，通过加工后的merge文件处理得到，存在full_cleaned_data.csv和full_monthly_market_data.csv文件中


### 3.2 模型选择与设计
针对东京民宿市场的月度预测任务，本项目采用了传统统计学时间序列模型与现代机器学习集成算法相结合的策略，选定以下模型进行对比实验：
1. SARIMA (季节性自回归差分移动平均模型)
   - 选择原因：通过代码中的季节性分解发现东京市场有极强的 12 个月周期性。SARIMA 能够显式处理这类非平稳序列。
   - 优点：数学理论成熟，能精准捕捉线性季节性规律；模型参数较少，不易在极小样本上产生剧烈震荡。 
   - 缺点：单变量局限性显著，无法直接整合房源基础属性（如 superhost）或市场竞争特征；对非线性突发波动（如政策变动）的自适应能力较弱。 
   - 适用性：适合本项目这种样本量较小（12个月聚合数据）、季节性极强的基准入住率预测。

2. Prophet (加性模型)
   - 选择原因：用于处理节假日效应（如日本元旦、樱花季）。代码中利用其进行趋势与季节项的解构。 
   - 优点：能够直观地将时间序列分解为趋势、年度季节性和残差，解释性极佳。 
   - 缺点：在月度数据上的颗粒度较粗，且默认的柔性趋势（changepoints）在只有 12 个点的情况下极易过拟合，导致远期预测出现线性偏移。 
   - 适用性：适合作为业务趋势的辅助验证工具。

3. XGBoost (极端梯度提升树)
   - 选择原因：在扩展任务中，为了引入“预订提前期”等动态影响因素，我们选用了基于树模型的集成算法。 
   - 优点：能够捕捉变量间的非线性抑制关系；通过特征重要性发现“平均预订提前期”是核心预测指标。 
   - 缺点：缺乏时序敏感性，必须通过构造复杂的滞后特征（Lag Features）才能模拟时间特征，且在数据样本量不足（Row < 50）时容易陷入局部最优解。 
   - 适用性：适合多因素影响下的回归分析。

4. VAR (向量自回归模型)
   - 选择原因：在代码中用于研究“价格”与“入住率”的相互演化关系。 
   - 优点：能够捕捉多变量间的双向反馈机制。 
   - 缺点：对样本量要求极高。代码实验显示，在仅有 12 个月数据的情况下，VAR 模型的自由度受限，预测结果的 MAE (0.1091) 显著高于单变量模型，实用性受限。 
   - 适用性：仅用于探索变量间的动态因果逻辑，不作为最终数值预测的首选。



### 3.3 超参数设置与训练细节
在模型开发过程中，我们针对不同算法的特性进行了细致的参数调整与实验记录，具体细节如下：
1. 各模型关键超参数设置
- SARIMA 模型：
  - 非季节性参数 (p, d, q)：经过平稳性检验（ADF Test）与 AIC/BIC 准则筛选，最终确定为 (2, 1, 1)。其中 d=1 确保了序列的一阶平稳，$p=2$ 捕捉了前两期的自相关影响。
  - 季节性参数 (P, D, Q, s)：设置 s=12（月度周期），通过消融实验验证了季节性差分对樱花季预测的必要性。
- XGBoost 模型：
  - 树的数量 (n_estimators)：设置为 100，避免在小样本月度数据上过拟合。
  - 最大深度 (max_depth)：设置为 3，保持弱分类器的特性以增强泛化能力。
  - 学习率 (learning_rate)：设置为 0.1，确保收敛过程稳健。
- Prophet 模型：
  - 季节性模式：开启 yearly_seasonality=True，专门适配东京市场的年度旅游周期。
  - 灵活性 (Changepoint Prior Scale)：采用默认值 0.05，以平衡趋势变化的灵敏度与稳定性。
- VAR 模型：
  - 滞后阶数：根据 model.select_order 结果选定 lag=1，这是在有限自由度下保持模型稳定的折中选择。 
2. 调参方法与验证策略
- 调参方法：
  - 手动调参 + 消融分析 (Ablation Study)：针对 SARIMA 模型，我们在 03_time_series_forecast.ipynb 中对比了不同参数组合（如 ARIMA(2,1,1) vs ARIMA(1,1,2)）在测试集上的 MAE 表现。
  - 启发式搜索：利用 AIC（赤池信息准则）自动寻找统计模型的最佳阶数。
- 验证设置：
  - 留出法 (Hold-out Validation)：由于时间序列具有严格的顺序性，我们未采用随机 K 折交叉验证，而是将 2025 年 11 月（数据集最后一个月）作为独立的验证集，用前 11 个月进行训练，确保预测具有前瞻性。
3. 训练环境与实现说明
- 开发框架：
  - 统计建模：使用 statsmodels 库实现 SARIMA 训练与 ADF 平稳性检验。
  - 机器学习：使用 xgboost 原生库及 scikit-learn 进行特征预处理与评估。
  - 时间序列工具：使用 facebook-prophet 进行季节性分解与趋势预测。
- 硬件与计算环境：
  - 计算资源：本项目模型在标准 CPU 环境下运行，由于月度聚合数据量适中，单次模型训练及消融实验均在秒级完成。
  - 软件环境：Python 3.12，主要依赖 pandas 进行数据清洗，matplotlib/seaborn 进行可视化呈现。

---

## 4. 实验设计与结果分析

### 4.1 数据集划分与评估指标

- 训练 / 验证 / 测试划分方式：
  - 随机划分比例（如 6:2:2）或基于时间的划分（如按日期切分）。
  - 多次随机划分是否取平均结果。
- 评价指标：
  - 回归任务：MSE、RMSE、MAE、R² 等。
  - 分类任务：Accuracy、Precision、Recall、F1、AUC 等。
  - 若是聚类或画像类任务，可说明使用的轮廓系数、组内/组间差异等定量或定性指标。

### 4.2 结果展示（表格与图形）
- 模型对比图：

| 预测模型    | 关键参数   | 测试集 MAE | 测试集 RMSE | 评价                      |
|---------|------|---------|----------|---------------------------------|
| SARIMA  | (2, 1, 1)x(0,1,0)12  | 	0.0511 | 	0.0511  | 	性能最优，捕捉季节性最精准   |
| XGBoost | 	n_estimators=100     | 	0.0566 | 0.0566   | 	表现稳健，非线性拟合较好 |
| Prophet | 	Yearly Seasonality   | 	0.0599 | 	0.0599	 | 整体趋势正确，但峰值预测略保守 |
| VAR     |    lag=1                 | 0.1091  | 0.1112   |  样本量较少时稳定性欠佳      |

- 重要特征排序图：

![img.png](img.png)
- 图注说明：图表清晰地展示了“预订提前期”在预测中的统治地位。这意味着房东如果能监控到订单提前到来的趋势，就能极高概率预判未来的满房情况。
- 关键关系可视化：
![pricing_strategy_comparison.png](pricing_strategy_comparison.png)
- 图注说明：相关系数高达 0.7054。在大多数零售行业，价格与需求通常呈负相关（涨价导致需求下降），但在东京短租市场，两者呈现强正相关。这表明市场具有强烈的季节性需求驱动特征：在旅游旺季，尽管价格大幅上涨，入住率依然居高不下。
![key_metrics_trends.png](key_metrics_trends.png)
- 图注说明：第一波峰（樱花季）：4月，入住率达到全年最高点 69.34%。此时房价处于次高位，体现了极强的溢价能力。第二波峰（跨年季）：12月，入住率回升至 63.50%。受圣诞及元旦假期影响，房价达到全年最高点。波谷（夏季淡季）：7月（51.26%） 和 8月（46.61%）。由于东京夏季气候炎热且缺乏重大节日，需求萎缩明显，房价也降至全年最低区间。
![img_1.png](img_1.png)
- 图注说明：
- 上左：RandomForest 误差最低（MAE≈0.022），SMA、线性回归、Prophet 依次变差，SARIMA 和指数平滑最差（MAE≈0.12）。 - 结论：在平均绝对误差上，RandomForest 是当前最优模型，传统时序模型（SARIMA、指数平滑）效果明显偏弱。
- 上右：各模型测试集 RMSE 对比
- 排名与 MAE 基本一致：RandomForest RMSE 最低（≈0.024），随后是 SMA、线性回归、Prophet、SARIMA，指数平滑最高。
- 结论：从平方误差角度看，RandomForest 同样最稳健，说明它不仅平均误差小，极端误差也较少。
- 下左：训练集 vs 测试集 MAE 散点图
- 大多数点靠近红色 y=x 线，说明训练误差与测试误差接近，整体过拟合不严重。
- 指数平滑在两个集合上误差都大；RandomForest 训练和测试 MAE 都很低且接近，是“低偏差、低方差”的理想状态。
- 结论：模型泛化整体良好，尤其是 RandomForest，说明特征工程与正则化设置较合理。
- 下右：Top3 模型预测对比（RandomForest、SMA、线性回归）
- RandomForest（蓝线）能较好跟随测试期真实入住率的上升与回落趋势；
- 线性回归（绿线）能捕捉方向但幅度偏小；SMA（橙线）基本接近一条平线，几乎不反映变化。
- 结论：RandomForest 在时间维度上对趋势和波动的拟合最接近真实值，是当前推荐的生产模型；SMA 适合作为简单基线，不适合作运营决策。
![seasonality_analysis.png](seasonality_analysis.png)
- 图注说明：通过季节性分解，我们确认了东京民宿市场的双峰季节性规律。4月（樱花季）和12月（元旦）是核心收益期，其中4月的平均入住率比8月淡季高出约 22.7%。这为房东提供了重要的市场洞察，有助于制定合理的预订策略和价格调整计划。
![img_2.png](img_2.png)
- 图注说明：
- 左图：Prophet 不同配置的测试集 MAE
- Smooth(changepoint=0.05)、Baseline(changepoint=0.2)、Multiplicative Seasonality 三种配置 MAE 极其接近（≈0.060），差异可以忽略。
- 将 changepoint_prior_scale 调大为 0.5（Flexible）或改用 Linear Growth，MAE 明显上升到 ≈0.178–0.181，误差接近翻三倍。
- 结论：过于灵活的趋势（changepoint 过大）或简单线性趋势都会让 Prophet 过拟合/欠拟合，显著恶化预测精度。
- 右图：Prophet 不同配置的测试集 RMSE
- 前三种配置 RMSE 约 0.073，数值再次非常接近，说明在波动和极端误差上表现相似。
- Flexible 和 Linear Growth 的 RMSE 升至 ≈0.189–0.193，与 MAE 的结论一致，表明它们在极端点上误差也明显更大。
- 综合结论：本数据集下，使用默认/较小 changepoint_prior_scale + 乘法季节性是较稳妥配置；不建议把 changepoint 调得过大或改为线性趋势，否则 Prophet 预测质量会显著下降。
![deep_learning_forecast_comparison.png](deep_learning_forecast_comparison.png)
- 图注说明：
- (a) 深度学习预测对比（左上）：
- LSTM 与 GRU 模型在测试集上的表现高度一致（MAE均为0.061），均优于 VAR 模型，但略逊于 XGBoost。 
- (b) 训练收敛过程（右上 & 左下）： 
- 展示了 LSTM 和 GRU 随 Epoch 增加的训练损失（蓝线）与验证损失（橙线）变化。注：验证损失后期的上升趋势提示模型可能存在一定的过拟合现象。 
- (c) 性能指标总览（右下）： 
- 对比了本研究中所有模型的平均绝对误差（MAE）和均方根误差（RMSE）。从柱状图可见，非线性模型（XGBoost, LSTM, GRU）整体优于线性模型（VAR），其中集成学习方法 XGBoost 在两项指标上均达到最优。
![multivariate_forecast_comparison.png](multivariate_forecast_comparison.png)
- 图注说明：
-  (a) 上图： 展示了测试集时间窗口内的预测曲线。VAR 模型（橙线）能够捕捉大致趋势但误差较大（MAE=0.109），而 XGBoost 模型（绿点）在训练/测试分界线后的单点预测中表现出极高的准确度（MAE=0.057）。 
-  (b) 下图： 基于 XGBoost 模型的特征重要性（Feature Importance）排序。结果表明，历史数据中的“平均提前预订人数”、“平均入住天数”以及滞后期的入住率是影响当前入住率预测的最关键因子。



### 4.3 结果分析与业务解读
- 模型表现深度分析：
  - 最优模型：SARIMA(2,1,1) 在消融实验中脱颖而出，其测试集 MAE（0.0511）显著优于常规 Prophet 模型。这说明东京民宿市场具有极强的线性季节性规律，传统的统计模型在小样本（N=12月）下比复杂的机器学习模型更具鲁棒性。 
  - 拟合情况：模型在训练集和测试集误差接近，未出现严重的过拟合。但 VAR 模型由于参数过多，在极短序列上表现不佳，说明在数据规模受限时应优先选择参数简约的模型。
- 业务画像： 
基于特征重要性与 EDA 统计，我们将东京的高收益房源勾勒为以下画像：
  - 预售能力强：平均预订提前期在 45 天以上。这类房东擅长远期库存管理，在旅游旺季到来前两个月就已锁定了大部分收入。 
  - 订单粘性高：平均入住天数（Length of Stay）较长，能够有效减少房间空置的碎片化时间，提升整体入住率。 
  - 价格敏感度低：这类房源多为“整套公寓”，即便在房价高达 129 USD（约 19,000 日元）的 4 月份，依然能保持近 70% 的高入住率，具有极强的溢价能力。 
- 决策建议:
  - 利用“提前期”进行定价预警：房东应重点监控 booking_lead_time_avg 指标。若观察到远期订单量在 1-2 月就开始异常增加，应果断调高 4 月樱花季的阶梯定价。 
  - 淡季慎用降价手段：根据代码中任务的模拟：降价 10% 仅能带来微弱的订单提升，但会导致总收入预计下降 27.08%。这说明东京市场在淡季对价格的敏感度不足以抵消降价损失。建议房东在 7-8 月淡季通过提升“超赞房东”服务指标或增加房源设施来维持吸引力，而非盲目卷入价格战。
  - 库存管理优化：由于 4 月和 12 月是绝对旺季，建议房东在 3 月和 11 月提前完成房源的大型维护和修缮，确保在高峰期以 100% 的完好度迎接市场高价订单。

---

## 5. 结论与不足

### 5.1 主要结论

- 市场季节性规律显著：通过对东京民宿市场的分析，确认了入住率和房价存在明显的“双峰”特征。4月（樱花季）和12月（元旦）是核心收益期，其中4月的平均入住率比8月淡季高出约 22.7%。
- 预测模型选型明确：在对比了多种模型后，SARIMA(2,1,1) 以 MAE 为 0.0511 的成绩表现最优，证明了在小样本、强周期的数据背景下，参数精简的统计模型优于复杂的机器学习模型。
- 核心驱动因素识别：利用 XGBoost 的特征重要性分析发现，“平均预订提前期”（booking_lead_time_avg）**对入住率的预测贡献度超过 50%，是房东提前感知市场热度的最关键指标。
- 价格策略敏感度：通过价格弹性分析（系数为 1.7495）及策略模拟得出，降价在淡季（如8月）对需求的拉动作用有限。模拟显示降价10%会导致总收入下降约 27.08%，因此“以价换量”在东京民宿市场需极其谨慎。

### 5.2 不足与改进方向
1. 数据层面不足：
  - 样本量限制：目前仅有 12 个月的月度聚合数据。由于时间序列长度较短，导致多变量模型（如 VAR）的自由度受限，难以充分发挥其捕捉复杂反馈机制的能力。 
  - 特征维度缺失：数据中缺乏诸如“樱花预测日期”、“大型展会/演唱会日程”以及“竞争对手实时调价数据”等外源变量，这些往往是导致异常波动的主因。
2. 方法层面不足： 
  - 模型局限性：SARIMA 虽擅长处理线性周期，但难以处理非线性突发事件的影响。VAR 模型在小样本下展现出不稳定性，MAE 明显偏高（0.1091）。
3. 未来改进方向：
  - 引入日粒度数据：从月度聚合深入到日度分析，以捕捉更细微的周内波动。 
  - 引入外生变量 (SARIMAX)：尝试将气象数据、日元汇率波动等作为外部变量引入模型，提升对国际游客流量的预测准确性。 
  - 因果推断分析：利用因果模型深入探究“超赞房东”标签与“预订提前期”之间的转化逻辑。

---

## 6. 小组协作与个人收获

### 6.1 分工与协作情况

- 小组的合作方式：
- 小组分工，在GitHub小组仓库克隆到自己
- GitHub ：我们采用分支+分时工作模式，四个人每两人完成一块内容，协商讨论，创建一个分支data/eda/tokyo和分支feature/cxy，一人完成任务后commit和push
提交到小组仓库后，由对方Git提取下来继续完成。最后完成后提交分支，由大家一起审核没问题后合并至主分支main，确保代码版本一致；

- 成果整合：各成员完成各自模块后，由展示与写作负责人汇总成果完成大致的报告和ppt框架内容，EDA 负责人提供可视化图表，建模负责人提供预测结果，代码负责人提供代码支撑等等，最后完善内容作业；
 
- GitHub 提交记录截图（附录中）

### 6.2 个人收获

- 邓文惠 ：从这次数据清理和EDA操作中，我开始学习明白了从数据清洗、分布分析、月度趋势这些我找到的的方向去挖掘到我需要的信息，比如相关性分析中找到众多数据
里面我需要的会发生强相关性的影响因素，还学会了基于此绘制多维度可视化图表，更直观看出差异、关系，产出的可视化图表为我们的任务提供了更加直白有用的帮助。

- 褚欣怡 ：我通过实践完成了特征工程对模型效果的关键影响，学习并且能够找到相关的模型进行实践操作，应用了 XGBoost 与 ARIMA 模型的搭建、调参与评估方法，
认识到 “特征质量比模型复杂度更重要”，明白了搭建模型运用到实际需求的帮助。

- 蒋政洋：在本项目中我主要负责多变量 VAR 模型和策略分析。我深刻体会到数据规模对模型选型的影响——理论上更先进的多变量模型（VAR）在样本不足时反而不如单变量 SARIMA 稳健。这让我明白了“合适胜过先进”的建模原则，同时也学会了如何将价格弹性系数转化为可落地的业务建议。

- 蒋靖豪：通过这次数据清洗与EDA实践，我深刻理解了从原始数据到可用分析数据的完整处理流程，学会了系统性地处理缺失值和异常值，掌握了通过可视化发现数据规律的方法，并认识到干净可靠的数据是后续建模分析的坚实基础。

---

## 7. 附录
- 📂 主要代码结构说明：
```text
project/
├─ data/
│  ├─ raw/                          # 原始数据 (Listings Data.csv, Past Calendar Rates.csv)
│  └─ processed/                    # 清洗后数据
│       ├─ full_cleaned_data.csv                    # 完整处理后数据
│       ├─ full_monthly_market_data.csv             # 用于预测的月度聚合数据
│       └─ merged_calendar_listings_latest.csv      # 初步处理后的中间文件
├─ src/                             # 核心源代码
│  ├─ data.py                       # 数据加载与清洗脚本
│  ├─ utils.py                      # 通用工具函数（EDA、特征工程、建模）
│  └─ main.py                       # 主流程控制脚本
├─ notebooks/                       # Jupyter Notebook 实验记录
│  ├─ 01_data_cleaning.ipynb        # 数据预处理与清洗
│  ├─ 02_eda_model.ipynb            # EDA、异常值与缺失值处理
│  ├─ 03_time_series_forecast.ipynb # 模型构建与训练（训练集划分）
│  └─ 04_project2_optional_task.ipynb 
├─ reports/                        # 产出报告与资源
│  ├─ 图片（21张）.png               # 可视化分析图表
│  ├─ report_template.md           # 最终报告
│  ├─ full_eda_summary_report.txt  # EDA 总结报告
│  └─ forecast_summary_report.txt  # 预测结果报告
└─ project2_monthly_dynamics_forecast.md  # 项目说明文档
```
- 关键函数/脚本的说明（例如：`train.py`、`feature_engineering.py`、`eda.ipynb`）。
- 1、01_data_cleaning.ipynb ，对导入的未处理两个文件进行规范化的调整，然后针对市场需求的筛选条件筛选出符合目的的表格
- 2、02_eda_model.ipynb ，在上一个ipynb操作生成的两个图标文件基础上，对于里面的异常值、缺失值进行调整，补充文件，然后按月度进行划分得到符合市场调整的文档表格
- 3、03_time_series_forecast.ipynb ，
- 4、04_project2_optional_task.ipynb ，

- 运行项目的简要步骤： 
- 1、环境准备：安装依赖库（pip install pandas numpy matplotlib seaborn scikit-learn xgboost statsmodels）； 
- 2、数据准备：将原始两表放入 notebooks/ 目录； 经过处理后，将新创立的图片和报告结论放到data/processed/ 目录中。
- 3、一键运行：在 PyCharm 中运行 src/main.py，完成数据清洗、EDA、特征工程、建模与预测等等任务要求后，所有结果自动保存至对应目录reports/ 中； 
- 4、结果查看：在 data/processed/ 查看清洗后数据，在 reports / 查看各类报告与图表；
  
- GitHub 提交记录截图(在reports/Git-log中)
- 1、蒋政洋： 

![jzy.png](jzy.png)
- 2、邓文惠：

![dwh.png](dwh.png)
- 3、褚欣怡：

![cxy1.png](cxy1.png)
![cxy2.png](cxy2.png)
- 4、蒋靖豪：

![jjh.png](jjh.png)

- 使用 Issues 记录 Bug、改进建议和待办任务
![mistakes.png](mistakes.png)
- 使用 Projects 看板管理进度
![img_3.png](img_3.png)

