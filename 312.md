# 机器学习课程设计项目报告



---

## 1. 项目基本信息

- 小组编号：312
- 课题名称：城市市场细分与房源聚类
- 选定城市及范围：Paris
- 选定时间范围：2024.11——2025.11
- 所用数据表：Listings / Calendar Rates / Reviews
- 项目 Github 仓库地址：https://github.com/ZJUT-CS/ml-course-project-2025-312.git

### 1.1 小组成员与角色分工
 

| 成员   | 姓名 | 学号 | GitHub 用户名 | 主要负责内容（简要）      |
|--------|------|------|---------------|---------------------------|
| 学生 1 |陈培宇| 302023562018     | Ttempesttt    | 数据 & EDA 负责人           |
| 学生 2 |刘柴乐|    302023562002  | Trancific     | 特征工程 & 建模负责人       |
| 学生 3 | 郭晋 |   302023562066   | guojin2023    | 工程实现 & 代码负责人       |
| 学生 4 |宋善凯|  302023562056    |  hjvhfds      | 报告撰写 & 展示负责人       |

---

## 2. 问题背景与数据集说明

### 2.1 业务背景与研究问题
- 项目背景：
  - Airbnb 是一个连接房东与房客的短租平台，房东发布房源信息，房客根据需求预订。本项目旨在通过对巴黎房源数据进行聚类分析，实现市场细分，帮助房东明确房源定位、优化定价与运营策略，帮助平台制定更精准的推荐与营销策略。
- 本项目的核心问题：
    - 基于房源的多维特征（如价格、房间数、设施、口碑等），将房源划分为具有业务意义的细分市场，并为每个细分市场建立可解释的画像。

### 2.2 数据来源与筛选规则

- 数据来源：AirROI Data Portal
- 所使用的数据表及其作用：
  - Listings Data：房源静态特征与近期表现
  - Calendar Rates：价格与可售状态
  - Reviews Data：评分与评论数据
- 样本量与筛选条件：
  - 初始样本量：286条。
  - 筛选规则：去除缺失严重样本，使用3σ原则剔除极端值（价格、入住天数）。
- 核心特征说明：
    - 核心分析特征：['guests', 'bedrooms', 'baths', 'min_nights', 'instant_book', 'amenities_count', 'has_wifi', 'has_kitchen', 'has_washer', 'has_parking', 'has_elevator', 'avg_rate_composite', 'ttm_revpar', 'occupancy_stability', 'is_long_term', 'num_reviews', 'rating_overall', 'rating_location']
      - 属性与设施特征（如 bedrooms, has_kitchen, has_parking）决定了房源的物理属性与适合人群（家庭、商务、自驾游客等）。

      - 价格与收益特征（如 avg_rate_composite, ttm_revpar）直接划分房源的市场层级与经济表现。

      - 运营与政策特征（如 min_nights, instant_book, occupancy_stability）反映房源的运营策略与稳定性。

      - 口碑与活跃度特征（如 rating_overall, num_reviews）体现房源的市场认可度与历史表现。

  - 这些特征共同构成了房源的多维度画像，预期能在聚类中清晰区分出“平价刚需房源”、“性价比舒适房源”、“高端精品房源”这三个对于不同用户需求进行的市场细分。

### 2.3 预期目标与分析思路

- 将房源划分为3个具有业务解释力的聚类
- 为每个聚类建立市场画像并命名
- 通过可视化展示聚类特征差异
- 技术路径：EDA → 特征工程 → 聚类建模 → 可视化与业务解读


## 3. 方法与模型设计

### 3.1 数据预处理与特征工程

- 缺失值处理方式：数值型用中位数填补，类别型用众数填补。
- 异常值处理：使用3σ原则剔除价格、入住天数的极端值
- 特征工程：
  - 连续变量：标准化（z-score）。
  - 派生特征：amenities_count（设施总数）、关键设施布尔变量（wifi、厨房、洗衣机等）。

### 3.2 模型选择与设计
 - 模型列表：
   - 基线模型：KMeans（硬聚类，简单高效，易于解释）
  
   - 改进模型：GMM（软聚类，提供概率分配，适应不同分布形状）
  
   - 聚类数k通过轮廓系数与Calinski-Harabasz指数评估确定
  

### 3.3 超参数设置与训练细节

- KMeans：n_init=10, random_state=42
- GMM：组件数同k，协方差类型设为full
- 评估方法：
   - 轮廓系数（Silhouette Score）与CH指数（Calinski-Harabasz）
- 调参方法：
  - 网格搜索 +交叉验证
- 训练环境与实现说明：
  - scikit-learn，CPU运行

---

## 4. 实验设计与结果分析

### 4.1 数据集划分与评估指标

- 训练 / 验证 / 测试划分方式：
  - 全部数据用于聚类，无需划分训练/测试集
- 评价指标：
  - 评估指标：轮廓系数（越接近1越好）、CH指数（越大越好）

### 4.2 结果展示（表格与图形）
最优聚类数评估结果：

|聚类数k	|轮廓系数	|CH指数	|状态|
|---------|---------|-------|----|
|3	|0.2003	|53.21	|最优|
|4	|0.1834	|47.68	|有效|
|5	|0.1800	|45.73	|有效|

模型性能对比：

|模型	|聚类数k	|轮廓系数	|CH指数	|标签列名	|模型类型|
|-----|---------|---------|-------|---------|--------|
|KMeans|	3	|0.2003	|53.21	|kmeans_cluster	|硬聚类（基线）|
|GMM	|3	|0.0772	|24.72	|gmm_cluster	|软聚类（改进）|

聚类样本分布：

|聚类标签	|样本数量	|占比|
|---------|---------|----|
|0	|203	|70.98%|
|1	|32	|11.19%|
|2	|51	|17.83%|

### 4.3 结果分析与业务解读

- 对不同模型表现的分析：
- KMeans表现优于GMM，轮廓系数与CH指数均更高，说明硬聚类更适配当前数据结构
- 聚类结果清晰分为三类，具备明显业务差异：

    - 聚类0：平价刚需房源（70.98%）
      特征：各指标均值偏低，性价比高
      定位：预算有限人群（学生、普通游客）

    - 聚类1：性价比舒适房源（11.19%）
      特征：指标均衡，舒适度与价格平衡
      定位：家庭出游、短途差旅人群

    - 聚类2：高端精品房源（17.83%）
      特征：各指标均值最高，设施齐全，口碑好
      定位：高消费人群（度假、商务出行）
 


## 5. 结论与不足

### 5.1 主要结论

- 通过聚类分析成功将巴黎房源划分为三个具有明确业务意义的细分市场

- KMeans模型在本次任务中表现更优，适用于后续工程落地

- 高端精品房源虽占比少，但收益与口碑表现突出，具备高附加值潜力

- 平价刚需房源占比最大，是市场基本盘，需注重成本控制与基础体验

### 5.2 不足与改进方向

- 数据量较小（286条），可能影响聚类稳定性

- 未使用文本评论进行情感分析，未能捕捉用户深层偏好

- 地理信息未充分用于空间聚类分析

- 未来可引入更多时序特征、评论文本建模、图神经网络等进行深度挖掘

一、当前聚类模型的核心局限性（客观、有依据，不空洞）
1. 技术层面局限性
聚类算法本身的局限：
本次实验用的 KMeans 和 GMM 都属于「距离 / 密度类聚类算法」，存在明显短板：
✅ 问题：KMeans 对异常值、数据分布（如非球形聚类）敏感，若房源数据中存在极端值（如超高端豪宅、极低价格房源），会拉偏聚类中心，导致普通房源的分类结果失真；GMM 虽能适配非球形分布，但对初始参数敏感，可能出现局部最优解。
✅ 实验体现：代码中仅用了 “轮廓系数 / CH/DB”3 个无监督指标评估，缺乏真实业务标签的验证（比如运营人员对房源的人工分类），无法判断聚类结果是否贴合实际业务场景。
数据与特征层面局限：
✅ 问题：代码中仅用了数值型特征（如价格、面积、配套数），未纳入类别型特征（如房源户型、所在区域、装修风格）和文本特征（如用户评价、房源描述），特征维度单一，导致聚类结果无法反映房源的 “非数值化核心差异”（比如同价格的 “市中心小户型” 和 “郊区大户型” 会被归为一类）。
✅ 实验体现：数据验证环节仅检查了缺失值 / 样本量，未做异常值处理、特征标准化的鲁棒性验证，若数据分布变化（如新增房源数据），模型泛化能力差。
2. 业务层面局限性
聚类结果的业务可解释性不足：
代码中自动生成的 “高端 / 平价 / 性价比” 画像偏通用，未结合巴黎本地的业务场景（如旅游旺季房源需求、不同行政区的房源属性差异），比如 “高端房源” 未区分 “塞纳河景观房”“市中心商务房”，分类结果对运营策略的指导粒度太粗。
模型无动态更新能力：
代码是 “一次性离线聚类”，无法适配实时数据变化（如房源价格波动、新增房源、用户需求变化），比如旅游旺季短租房源的特征权重（如入住率）会显著变化，静态模型的分类结果会快速失效。

二、未来改进方向（分「短期易落地」和「长期进阶」，有可操作性）
1. 短期改进（基于现有代码，低成本优化）
算法与评估优化：
✅ 技术动作：① 在 utils.py 中新增 “异常值处理模块”（如用 IQR 法过滤极端房源数据），提升 KMeans/GMM 的稳定性；② 引入 “半监督聚类” 思路 —— 结合运营人员标注的少量房源标签，用 LabelPropagation（标签传播）修正无监督聚类结果，代码中可新增sklearn.semi_supervised相关函数，补充 “标注准确率” 等业务指标。
✅ 业务价值：让聚类结果既符合数据规律，又贴合运营人员的实际判断，避免 “技术指标好看但业务没用” 的问题。
特征与数据优化：
✅ 技术动作：① 在数据加载模块（utils.py）中新增类别特征编码（如 One-Hot、目标编码）、文本特征提取（如 TF-IDF 处理房源描述），丰富特征维度；② 新增 “特征重要性分析”（如 SHAP 值、方差贡献率），筛选出对聚类最关键的特征（如巴黎房源的 “距离地铁站距离”“是否含早餐”），提升结果的业务解释性。
✅ 业务价值：比如能区分 “同价格但不同区域” 的房源，让聚类结果精准匹配 “不同行政区的运营策略”。
2. 长期进阶（贴合业务落地，有前瞻性）
模型架构升级：
✅ 方向 1：替换更鲁棒的聚类算法 —— 在 utils.py 中新增 DBSCAN（抗异常值）、谱聚类（适配复杂分布），对比不同算法的结果，选择最贴合巴黎房源数据的方案；
✅ 方向 2：构建 “动态聚类模型”—— 结合时序数据（如房源月度价格、入住率），在 main.py 中新增定时更新逻辑，每月自动用新数据重新聚类，输出动态的房源画像（如旺季 “短租高性价比房源” 单独分类）。
业务落地层面升级：
✅ 方向 1：聚类结果与业务系统打通 —— 将带标签的房源数据对接定价系统、推荐系统，比如 “高端房源” 自动匹配高定价策略、推送给高端用户，“平价房源” 适配学生 / 背包客的需求；
✅ 方向 2：引入 A/B 测试验证 —— 用聚类结果划分房源分组，测试不同运营策略的效果（如高端房源的转化率、平价房源的入住率），反过来优化聚类模型的评估指标（比如新增 “运营转化效率” 作为聚类效果的评估维度）。
---

## 6. 小组协作与个人收获

### 6.1 分工与协作情况

- 小组采用GitHub进行版本管理，通过分支开发、Pull Request合并代码，定期开会同步进展，使用Issue跟踪任务。所有代码与报告均实现可复现。

### 6.2 个人收获（每人 3–5 句话）


- 学生 1（陈培宇）：掌握了数据探索与可视化的系统方法，提升了业务解读能力
- 学生 2（刘柴乐）：深入理解了特征工程与聚类模型调参，增强了模型评估与选择能力
- 学生 3（郭晋）：锻炼了工程化实现与代码可复现能力，熟悉了项目协作流程
- 学生 4（宋善凯）：提升了报告撰写与结果展示能力，学会了如何将技术结果转化为业务建议

---

## 7. 附录（可选）
- 项目目录：
```
data/
  README.md
   巴黎房源_带聚类标签.csv
   巴黎房源_构造后特征.csv
docs/
  房源市场细分画像报告.md
  数据加载与验证报告.md
  最优k值评估报告.md
  聚类模型性能对比报告.md
notebooks/
  README.md
  next.md
projects
reports/
  report_template.md
results/
  k值评估折线图.png
  各聚类核心特征对比图.png
src/
  modeling/
    data_load.py       # 数据加载与验证
    find_best_k.py     # 最优k值评估
    market_image.py    # 市场画像分析与可视化
    train_model.py     # 模型训练与标签生成
  main.py
  utils.py
.gitignore
REDME.md
requirements.txt

```
- 运行项目的简要步骤：
  安装依赖（建议使用虚拟环境或 Conda）：
```
pip install pandas numpy matplotlib scikit-learn --upgrade
```
运行示例程序（例如 src/main.py 中的占位示例）：

cd D:\新建文件夹\vs\git\ml-course-project-2025-312\src
python main.py --raw_data "../data/巴黎房源_构造后特征.csv"
具体操作步骤： 1.打开终端：
```
python -m venv venv venv\Scripts\activate
```
2.通过cd命令切换到src/目录下 cd D:\新建文件夹\vs\git\ml-course-project-2025-312\src

3.在src/目录下执行以下命令，使用默认配置运行 
```
python main.py --raw_data "../data/巴黎房源_构造后特征.csv"
```
4.修改输出路径、k 值范围等参数，可使用以下扩展命令 
```
python main.py ^ --raw_data "../data/巴黎房源_构造后特征.csv" ^ --k_range 2 3 4 5 6 ^ --log_file "../logs/custom_run.log" ^ --portrait_report "../docs/自定义画像报告.md" ^ --feature_fig "../results/自定义特征对比图.png"
```

5.命令行参数说明 参数名 作用 示例值 --raw_data 指定原始特征数据路径（核心输入） ../data/巴黎房源_构造后特征.csv --labeled_data 带聚类标签数据的保存路径 ../data/自定义_带标签数据.csv --verify_report 数据验证报告保存路径 ../docs/自定义_数据验证报告.md --k_report 最优 k 值评估报告路径 ../docs/自定义_k值评估报告.md --model_report 模型性能对比报告路径 ../docs/自定义_模型对比报告.md --portrait_report 市场细分画像报告路径 ../docs/自定义_画像报告.md --k_fig k 值评估折线图保存路径 ../results/自定义_k值图.png --feature_fig 特征对比图保存路径 ../results/自定义_特征图.png --log_file 日志文件保存路径 ../logs/自定义日志.log --k_range 聚类数 k 的遍历范围 2 3 4 5（默认：3 4 5）



