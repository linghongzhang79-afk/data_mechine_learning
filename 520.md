## 1. 项目基本信息
# 机器学习课程设计项目报告

---

## 1. 项目基本信息

- 小组编号：520高大上
- 课题名称：首尔房源 房源收益预测与“优质房源画像”）
- 选定城市及范围： Seoul
- 选定时间范围：使用全部可用数据
- 所用数据表：Listings
- 项目 Github 仓库地址：https://github.com/ZJUT-CS/ml-course-project-2025-520

### 1.1 小组成员与角色分工（固定 4 人）

| 成员   | 姓名 | 学号 | GitHub 用户名 | 主要负责内容（简要）      |
|--------|------|------|---------------|---------------------------|
| 学生 1 | 方宏江     | 302023562038     |  fang756             | 数据 & EDA 负责人（Data & EDA Lead），特征工程 & 建模负责人（Modeling Lead），工程实现 & 代码负责人（MLOps / Engineering Lead），报告撰写 & 展示负责人（Report & Presentation Lead）                          |
| 学生 2 | 梁正合     | 302023562050     |  lzh1112             | 数据 & EDA 负责人（Data & EDA Lead），特征工程 & 建模负责人（Modeling Lead）                          |
| 学生 3 | 马智     | 302023562049     |    mz72510           |   报告撰写 & 展示负责人（Report & Presentation Lead），数据 & EDA 负责人（Data & EDA Lead）                        |
| 学生 4 | 刘沛泽     | 302023562057     | liupeize             |   报告撰写 & 展示负责人（Report & Presentation Lead），数据 & EDA 负责人（Data & EDA Lead）                        |

---

## 2. 问题背景与数据集说明

### 2.1 业务背景与研究问题

本项目目标是构建可解释且可落地的模型，用于预测房源收益（以 TTM RevPAR / RevPAR 为主），并据此总结“优质房源画像”，为运营提供改造与营销建议。核心业务目标包括：房源收益分级、识别潜力房源、构建运营优先级清单。

### 2.2 数据来源与筛选规则

- 数据来源：AirROI 提供的 Airbnb 数据（请在 `data/README.md` 中填写具体取得方式与样本说明）。
- 使用表与主要字段示例：
	- `listings`：`listing_id, city, latitude, longitude, guests, bedrooms, beds, baths, cleaning_fee, extra_guest_fee, instant_book, professional_management, superhost, num_reviews, rating_overall, rating_cleanliness, rating_location, rating_communication, ttm_revpar, ttm_avg_rate, ...`
- 筛选规则与预处理要点：
	- 仅保留目标城市的房源（在 `data/README.md` 标明城市清单）；
	- 过滤显著异常值（如负价格、occupancy 超出 [0,1]、极端 RevPAR）;
	- 对缺失严重的关键字段根据业务规则处理（删除或标记）；
	- 所有时间窗口类指标（含 `ttm_`, `l90d_`, `revpar` 等）在特征选择时谨慎处理以避免标签泄露。

### 2.3 预期目标与分析思路

- 输出：可用于运营的回归模型（预测 RevPAR）与一份面向运营经理的“优质房源画像”与可操作建议清单。
- 流程：数据探索 → 清洗与特征工程 → 基线与树模型对比（至少两种）→ 交叉验证与固定划分评估 → 模型解释（系数/贡献/SHAP）→ 业务建议。

---

## 3. 方法与模型设计

### 3.1 数据预处理与特征工程（实施细节）

- 缺失值处理：
	- 数值特征使用中位数填补（已在 `src/feature_engineering.py` 中实现）；
	- 类别与布尔特征使用众数或显式 0/1 填补；
	- 目标列缺失：脚本尝试基于可用收入列生成 `log_ttm_revenue`（`np.log1p`），若仍缺失则在训练前删除该样本。
- 泄露控制：移除或忽略可能包含未来信息的字段（关键词：`ttm_`, `l90d_`, `l30d_`, `revpar`, `revenue`, `avg_rate`, `occupancy` 等）。
- 衍生特征（已实现/建议）：
	- 尺寸比类：`guests_per_bedroom`, `guests_per_bath`；
	- 收费比类：`cleaning_fee_ratio = cleaning_fee / max(1, ttm_avg_rate)`；
	- 布尔指示：`has_extra_guest_fee`, `has_superhost`, `instant_book`, `professional_management`；
	- 需要注意：对数变换或分箱（如对 RevPAR、num_reviews）可在后续实验中尝试优化。

代码位置提示：
- 特征工程主函数：`src/feature_engineering.build_features(df)`；
- 数据拆分：`src/data_processing.split_train_val_test(df, target, test_size, val_size, random_state)`；

### 3.2 模型选择与实现

- Baseline（可解释）：线性回归（`sklearn.linear_model.LinearRegression`），易于解释系数并直接输出特征方向与重要性。
- 对比模型：随机森林（`sklearn.ensemble.RandomForestRegressor`）用于捕捉非线性关系；仓库中也有 LightGBM/XGBoost/CatBoost 的包装接口（如果安装相应依赖可启用）。
- 训练实现位于 `src/main.py`，支持命令行参数 `--model` 选择模型；baseline 支持 5 折 CV 并保存 CV 与固定划分指标。

### 3.3 训练与评估细节

- 交叉验证：baseline 使用 5 折 KFold（shuffle=True, 固定随机种子）；
- 固定划分：train/val/test（默认 test=0.15, val=0.15）；
- 指标：MAE、RMSE、R²（主要以 MAE 与 R² 向业务沟通）。

---

## 4. 实验设计与结果分析

### 4.1 数据集划分与样本量说明

训练集: (209, 25) (69.7%)
验证集: (46, 25) (15.3%)
测试集: (45, 25) (15.0%)

### 4.2 模型性能对比（测试集）

下表来自 `results/model_performance_comparison.csv`：

| 模型 | R²（测试） | MAE（测试） | RMSE（测试） | 与基线 MAE 改进 | 与基线 RMSE 改进 |
|------|-----------:|-----------:|------------:|-----------------:|------------------:|
| 均值预测（基线） | 0.0000 | 34.8397 | 49.5753 | - | - |
| 线性回归 | 0.6346 | 15.2123 | 22.0592 | 38.67% | 39.55% |
| 随机森林 | 0.5654 | 16.0042 | 24.0560 | 35.48% | 34.08% |

**结论**：线性回归在本数据与特征配置下取得最好综合表现（MAE 最低且 R² 最高），且模型易解释，适合直接落地到运营决策中。

### 4.3 交叉验证与固定划分结果（baseline）

- 5 折 CV 与固定划分结果已保存：`data/processed/models/linear_regression_metrics.json` 与 `outputs/linear_regression_metrics.json`（包含 CV 均值/标准差与固定划分的 train/val/test 指标）。
- 建议把 CV 的标准差作为模型稳定性参考，若测试集表现显著差于 CV 平均值，需审查数据泄露或分布差异。

### 4.4 重要特征与业务解读

依据 `results/model_interpretation/model_explanation_report.md` 与 `results/model_interpretation/feature_contributions.csv`：

- 排名前十的特征（样例）：`longitude`, `latitude`, `rating_checkin`, `rating_location`, `rating_accuracy`, `guests`, `guests_per_bath`, `baths`, `rating_communication`, `rating_cleanliness`。
- 业务含义要点：
	1. **评价体系（评分与评价数）**：与收益呈强正相关，说明提升评分与评价数量能直接带来更高 RevPAR；
	2. **地理位置**：位置和 location 评分为关键驱动因素，核心商圈房源溢价显著；
	3. **服务质量**：清洁、沟通等评分影响可观，应作为运营改造重点；
	4. **房源配置**：适中客容量与合理卧室数对 RevPAR 有正面贡献。

### 4.5 优质房源画像（面向运营经理）

以下为 3–5 条短句画像，便于运营快速理解并形成改造/筛选策略：

- 画像 A："2–3 间卧室的整套房 + 超级房东 + 支持即时预订，通常 TTM RevPAR 更高。"
- 画像 B："专业化管理（professional_management）的房源在同价位段表现更稳、RevPAR 通常更高。"
- 画像 C："位于核心商圈、location 评分高且评价数量多（例如 num_reviews > 20）的房源，收益明显优于同类郊区房源。"
- 画像 D（服务导向）："高清洁评分与高沟通评分的房源能吸引更高价格与入住率，建议把清洁与服务作为短期改造项。"

> 注：具体数值门槛（如 bedrooms=2–3, num_reviews>20, rating_overall>4.5）应基于你们所在城市数据进一步微调。

---

## 5. 结论与不足

### 5.1 主要结论

- 线性回归在本次实验表现最佳（测试集 R²≈0.63，MAE≈$15.21），兼具较好精度与可解释性，适合直接为运营提供规则化建议；
- 主要可优化维度为：评价体系、地理位置（选址/价格分区）与服务质量；
- 建议先在高收益潜力房源上做小规模改造与营销实验以验证模型建议的实际收益提升。

### 5.2 不足与改进方向

- 数据层面：缺乏细粒度时间序列与评论文本的深度利用，未来可接入 calendar 或 reviews 做时序/文本增强；
- 模型层面：尝试 LightGBM/XGBoost 并做系统性超参数搜索及分层建模（按 room_type 或价格段）；
- 实验设计：建议对关键改造措施做 A/B 实验验证（例如调整清洁费或强化评价邀请），并以实测收益评估模型建议的落地效果。

---

## 6. 小组协作与个人收获

### 6.1 分工与协作情况

- 描述小组整体的合作方式：
  - 统一使用了vscode将GitHub仓库克隆到每个人的电脑。
  - 在各自的电脑上开展工作，用vscode提交相应修改。
  - 遇到问题后，一起商讨并结合AI解决相应问题。

  ### 6.2 个人收获

- 方宏江：做一个项目还是有很大的困难，也是了解到这门课程在实际应用中怎么操作，为了能够更好了去了解这个项目，我还自主去学习做了“泰坦尼克号”遇难项目，也是收获很多。
- 梁正合：完成该项目时遇到了很多问题，但也有很多收获，通过学习波士顿房价预测模型，对此项目有了初步的处理思路与解决方案。
- 马智：在起初接到项目时的无措到与成员探讨商量，再到自己查阅资料，最终小组项目完成，遇到许多困难，但收获最终大于困惑.
- 刘沛泽：制作项目的过程是学习和进步的过程，在完成项目时掌握了更多新知识，受益匪浅，也锻炼了自身的团队协作能力，是一次很棒的学习体验

## 7. 附录

### 7.1 关键输出文件与路径

- `results/model_performance_comparison.csv` — 模型对比表；
- `results/model_recommendation.json` — 推荐模型与理由；
- `results/model_interpretation/model_explanation_report.md` — 解释性报告（含特征贡献表与业务解读）；
- `results/model_interpretation/business_decision_summary.txt` — 面向运营的决策要点；
- `data/processed/models/linear_regression_metrics.json` 或 `outputs/linear_regression_metrics.json` — baseline 的 CV 与固定划分详细指标；
- `outputs/high_performers_summary.md` — 自动生成的优质房源摘要（若模型输出支持）。

### 7.2 如何复现本次结果（操作步骤）

1. 在项目根目录创建并激活虚拟环境（推荐）：

```powershell
python -m venv .venv
.\.venv\Scripts\Activate.ps1
python -m pip install -r requirements.txt
```

2. 运行主流程（baseline 示例）：

```powershell
python -m src.main --model baseline
```

3. 输出位置：
- 本次运行通用指标与模型会被写入 `outputs/metrics.json`、`outputs/high_performers_summary.md`；
- 模型文件与详细指标写入 `data/processed/models/`；
- 汇总对比与解释材料保存在 `results/`。

---

报告说明：本报告基于 `reports/report_template.md` 与仓库中的 `results/` 输出文件自动生成。请在第一节填写小组信息、城市与时间范围后即为最终可提交版本。如需我把报告转换为 PDF 或基于报告生成 PPT（含图表），我可以继续帮助生成。
