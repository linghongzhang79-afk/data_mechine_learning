# 机器学习课程设计项目报告

---

## 1. 项目基本信息

- 小组编号：
- 课题名称：伦敦房源评论与口碑对房源表现的影响
- 选定城市及范围：London
- 选定时间范围：使用全部可用数据
- 所用数据表：cleaned、london-reviews
- 项目 Github 仓库地址：https://github.com/ZJUT-CS/ml-course-project-2025-aaaaa

### 1.1 小组成员与角色分工（固定 4 人）

> 建议角色：  
> - **EDA 负责人**：整体探索分析与可视化  
> - **建模负责人**：特征工程与模型选择调参  
> - **代码负责人**：项目结构、数据处理与训练脚本、可复现性  
> - **展示与写作负责人**：汇总结论、PPT、报告撰写与润色  

| 成员   | 姓名 | 学号 | GitHub 用户名 | 主要负责内容      |
|--------|------|------|---------------|---------------------------|
| 学生 1 | 洪莹霖|   302023562029  | Hirglee | 数据 & EDA 负责人 |
| 学生 2 | 杨颖  |   302023513091  | justa-feeling |    特征工程 & 建模负责人        |
| 学生 3 | 周琼  |   302023103018  | zhou487       |  工程实现 & 代码负责人   |
| 学生 4 | 余昕恬|   302023571041  | Xingsekoudai  |       报告撰写 & 展示负责人      |
---

## 2. 问题背景与数据集说明

### 2.1 业务背景与研究问题

- Airbnb 房源的评论数量和评分结构往往被认为影响其收入和入住率，但这种关系的强度和具体形式尚未明确量化。
- 本项目的核心问题包括：
  - 高评分是否一定带来更多订单和更高 RevPAR？
  - 哪一维评分更"值钱"——清洁度、位置、还是性价比？
  - 评论数量和评分高低之间如何共同作用？
- 本项目包含三个递进式的分析阶段：
  - **Model1**（房源级相关性分析）：量化评分与表现指标的关联程度
  - **Model2**（评论数量与口碑联合影响）：探究评分与评论量的联合作用效应
  - **Model3**（分类预测模型）：基于评分和评论信息预测房源是否为高收益房源
- 该研究的价值在于：帮助房东明确高收益房源的关键特征，针对性优化运营；指导平台优化房源推荐逻辑；为房客决策提供口碑参考。

### 2.2 数据来源与筛选规则

- 数据来源：AirROI Data Portal（URL：https://airroi.com/data-portal），伦敦房源数据。
- 所使用的数据表及其作用：
  - **cleaned.csv**：经清洗的房源表，包含口碑相关字段与经营表现指标
  - **london-reviews.csv**（可选）：原始评论记录，用于选做任务的时间序列分析
- 样本量与筛选条件：
  - 从原始数据中保留共 298 条有效房源记录
  - 筛选规则：删除核心字段（口碑/表现指标）有缺失的行，确保所有 7 个评分维度、评论数、收益和入住率数据完整
  - 处理零值异常：检测并分析数据中的零值异常和不一致性（如两列零值不一致）
- 核心特征说明（共15个字段）：
  - **口碑相关字段（8个）**：
    - `rating_overall`：整体评分（1-5分，反映房源总体质量）
    - `rating_accuracy`：描述准确度评分
    - `rating_checkin`：入住体验评分
    - `rating_cleanliness`：清洁度评分（维度中权重通常较高）
    - `rating_communication`：沟通评分
    - `rating_location`：位置评分（与收益关联度高）
    - `rating_value`：性价比评分
    - `num_reviews`：评论总数（代表房源的市场知名度和经营时长）
  - **表现指标字段（5个）**：
    - `ttm_revenue`：过去12个月总收益
    - `ttm_occupancy`：过去12个月入住率（调整后）
    - `ttm_revpar`：过去12个月平均客房收益（目标变量，用于定义高收益房源）
    - `l90d_revenue`：最近90天收益（近期表现）
    - `l90d_occupancy`：最近90天入住率
  - **其他字段**：
    - `listing_id`：房源唯一标识

### 2.3 预期目标与分析思路

- 本项目的预期输出：
  - **相关性量化**：计算各维度评分（`rating_overall`, `rating_cleanliness`, `rating_location` 等）与表现指标（`ttm_revpar`, `ttm_occupancy`）的相关系数，明确哪些评分维度对收益影响最大
  - **口碑联合效应**：通过象限分析法，将房源分为"高评分+高评论量"、"高评分+低评论量"、"中评分+高评论量"、"低评分+低评论量"四类，比较各类房源的表现差异
  - **分类预测模型**：构建两个模型（逻辑回归与XGBoost）预测房源是否为高收益房源（TTM RevPAR Top 25%），并分析特征重要性
  - **选做任务**（加分项）：分析评论爆发期与后续表现的关系；估计差评对收益的敏感度影响
- 分析思路流程：
  1. **EDA阶段**：检测数据质量，处理零值异常，绘制各指标分布
  2. **Model1阶段**：计算相关系数、绘制热力图，识别高影响评分维度
  3. **Model2阶段**：基于分位数划分评分与评论量，用Kruskal-Wallis检验验证组间差异显著性
  4. **Model3阶段**：特征工程与标准化，训练逻辑回归和XGBoost两个模型对比评估
  5. **可视化与解释**：通过条形图、热力图、小提琴图等展示核心发现，提炼业务建议

---

## 3. 方法与模型设计

### 3.1 数据预处理与特征工程

- **缺失值处理**：删除核心字段（所有 7 个评分维度、评论数、收益和入住率数据）有缺失的行，确保数据完整性
- **异常值检测与处理**：
  - 使用 1.5*IQR 规则检测箱型图异常值
  - 分析零值异常：检测除最后两列外的零值，以及最后两列（l90d_revenue、l90d_occupancy）的零值一致性
  - 处理方式：保留合理的异常值（如极低入住率），仅标记记录异常性质
- **特征工程**：
  - 连续变量：基于各维度评分和评论数量原始值进行分析；Model3中使用 `StandardScaler` 进行标准化
  - 派生特征：在Model2中基于分位数（Q25、Q75）划分评分和评论量进行四象限分类
  - 特征选择（Model3）：选取 7 个关键特征 `[num_reviews, rating_cleanliness, rating_location, rating_value, rating_accuracy, rating_communication, rating_checkin]` 作为模型输入

### 3.2 模型选择与设计

本项目包含三个主要分析模块：

#### 3.2.1 模型一：房源级相关性分析

**分析目的**：在房源级别量化各维度评分与经营表现的线性关系，为后续高阶分析奠定基础。

**方法设计**：
- 计算 Pearson 相关系数衡量线性关系强度
- 进行显著性检验（p值 < 0.05 表示显著），排除随机相关
- 覆盖的分析维度：
  - 整体评分（rating_overall）与三个核心表现指标的相关性
  - 六个具体维度评分（rating_accuracy, rating_checkin, rating_cleanliness, rating_communication, rating_location, rating_value）与五个表现指标的全交叉分析
- 输出形式：相关系数矩阵 + 热力图可视化

**关键假设**：
- 相关性分析反映的是 **统计关联**，不代表因果关系
- 假设线性关系能够合理解释房源评分与表现的关系

#### 3.2.2 模型二：评分与评论量组合分析

**分析目的**：单一的评分维度往往不足以全面衡量房源的市场竞争力。消费者在决策时，通常会结合**评分高低**与**评论基数**进行综合判断。本模型旨在通过构造"评分-评论量"联合矩阵，探究不同口碑组合对房源核心经营指标的影响是否存在显著差异。

**分组逻辑设计**：
- 采用**象限分析法**，基于样本分布的四分位数（Q25 与 Q75）提取出四个最具代表性的特征组进行对比分析
- 评分分段标准：
  - 高评分：`rating_overall > 4.8`
  - 评分一般：`4.5 <= rating_overall <= 4.8`
  - 评分较低：`rating_overall < 4.5`
- 评论量分段标准：
  - 评论较多：`num_reviews >= Q75`（Q75 = 194条）
  - 评论较少：`num_reviews <= Q25`（Q25 = 50条）
- 构造4类组合分组：
  1. **高评分+评论较多**：Rating > 4.8 且 Reviews >= Q75（标杆房源：高满意度且经过市场大量验证）
  2. **高评分+评论较少**：Rating > 4.8 且 Reviews <= Q25（潜力房源：好评率高但知名度或经营时长不足）
  3. **评分一般+评论较多**：4.5 <= Rating <= 4.8 且 Reviews >= Q75（主流房源：市场占有率高，表现稳健但缺乏极致口碑）
  4. **评分较低+评论较少**：Rating < 4.5 且 Reviews <= Q25（尾部房源：满意度较低且缺乏市场吸引力）

**统计检验方法**：
- 使用 **Kruskal-Wallis H 检验**（非参数单因素方差分析）验证各组间的差异是否具有统计学意义
- 原假设 (H0)：不同"评分-评论量"组合房源的指标中位数无显著差异
- 备择假设 (H1)：至少存在一组房源的表现与其他组有显著差异（P < 0.05）
- 适用于非正态分布数据，不要求方差齐性

**可视化方案**：
- **小提琴图 (Violin Plot)**：展示各组数据的概率密度分布，观察是否存在多峰或偏态，同时显示数据的分布形状
- **箱型图 (Box Plot)**：识别各组的中位数、分位数及异常值，直观对比各组表现的"下限"与"上限"

#### 3.2.3 模型三：高收益房源分类预测模型

**分析目的**：构建机器学习模型，基于评分和评论信息预测房源是否为高收益房源，并通过特征重要性分析识别关键驱动因素。

**目标变量定义**：
- **高收益房源**：TTM RevPAR 排名 Top 25% 的房源
- 标签：`is_high_revpar = (ttm_revpar >= quantile(ttm_revpar, 0.75))`

**特征集**：使用 7 个关键特征
- `num_reviews`：评论数量
- `rating_cleanliness`：清洁度评分
- `rating_location`：位置评分
- `rating_value`：性价比评分
- `rating_accuracy`：描述准确性评分
- `rating_communication`：沟通评分
- `rating_checkin`：入住体验评分

**模型选择与设计**：

本项目采用两个不同类型的模型进行对比分析，各具优缺点：

1. **模型A：逻辑回归（Logistic Regression）**
   - **优点**：
     - 易于解释：每个特征的系数直观反映其对高收益的促进/抑制作用
     - 计算效率高，适合快速部署
     - 不易过拟合，在中等规模数据集（298个样本）上表现稳健
   - **缺点**：
     - 假设特征与目标的关系为线性，可能遗漏非线性关系
   - **适用场景**：需要可解释性较强的业务决策场景

2. **模型B：XGBoost（极端梯度提升树）**
   - **优点**：
     - 自动学习非线性特征组合，捕捉复杂关系
     - 特征重要性排序更准确，考虑特征交互效应
     - 通常具有更高的预测精度
   - **缺点**：
     - 参数较多，调参工作量大
     - 黑盒性质较强，模型可解释性较低
   - **适用场景**：追求预测精度的应用

**对比意义**：通过两个模型的性能对比，可以判断：高收益房源的特征驱动机制是主要由线性关系主导，还是存在显著的非线性交互效应。

#### 3.2.4 选做一：评论爆发期分析方法与实现

 **分析目的**：挖掘评论波动对房源经营的影响，通过 Reviews Data 按月统计房源评论数，定义评论爆发期并关联后续经营数据，验证爆发期后入住率、收入是否明显提升。

  - **自变量选取**：以listing_id（房源唯一标识）和month（月份）为分组键，统计每个房源每月的总评论数，生成月度评论统计数据集，为后续爆发期识别奠定基础。

  - **评论爆发期定义**：设定爆发阈值：房源月评论数均值 + 1.5倍标准差，，识别具有统计显著性的评论激增；标记月度爆发期：将单月评论数超过上述阈值的记录，标记为is_burst_month（爆发月份）；标记房源级爆发期：只要某房源存在至少 1 个爆发月份，即标记为has_burst（有爆发期房源），反之则为无爆发期房源，实现房源的二元分类。

  - **表现指标字段（5个）**：
    - `ttm_revenue`：过去12个月总收益
    - `ttm_occupancy`：过去12个月入住率（调整后）
    - `ttm_revpar`：过去12个月平均客房收益（目标变量，用于定义高收益房源）
    - `l90d_revenue`：最近90天收益（近期表现）
    - `l90d_occupancy`：最近90天入住率

  **核心指标统计与量化对比**：

  针对房源核心经营指标，完成两组样本的均值统计与差异量化，核心统计指标包括ttm_revenue、ttm_occupancy、ttm_revpar、l90d_revenue、l90d_occupancy，统计逻辑如下：
  - 分别计算两组样本各指标的算术均值，保留 2 位小数，确保数据精度；
  - 计算两组指标的绝对差值（有爆发期均值 - 无爆发期均值），反映指标提升的绝对规模；
  - 计算两组指标的差异率（(有爆发期均值 - 无爆发期均值) / 无爆发期均值 × 100%），反映指标提升的相对幅度；
  - 整理量化结果为结构化表格，输出控制台用于直观查看，为后续结论提炼提供数据支撑。

  **可视化分析与趋势呈现**：

  - 采用双图组合展示分析结果，直观呈现评论爆发期的影响与评论时间趋势：
  - 指标对比柱状图：以 “有 / 无爆发期” 为分组维度，绘制 5 个核心经营指标的对比柱状图，标注具体均值数值，清晰展示两组样本的指标差异；
  - 月度评论时间序列折线图：以 “月份” 为横轴，“全量房源月度总评论数” 为纵轴，绘制折线图并添加标记点，呈现评论数的时间波动趋势。


#### 3.2.5 选做二：“差评冲击”的敏感度分析（近似）
  **分析目的**：基于一元线性回归模型量化整体评分下降对房源 TTM RevPAR 的直接影响幅度，近似评估 “差评冲击” 带来的潜在收益损失，为房源运营方提供口碑管理的直观参考依据，同时明确结果的统计关联性与非因果性。

  **目标变量定义**：
  **目标变量**：ttm_revpar（房源过去 12 个月每间可售房收入，反映房源核心经营收益表现）
  **核心解释变量**：rating_overall（房源整体评分，1-5 分，反映房源综合口碑水平）
  **控制变量（未启用，对应代码实现）**：num_reviews（评论数量）、rating_cleanliness/rating_location等维度评分（本代码优先实现核心变量的直接关联分析，可选加入以剔除其他因素干扰）

  **核心落地模型：一元线性回归（Simple Linear Regression）**：

  - 优点：系数解释性极强，可直接量化整体评分（rating_overall）每变化1分对应的 TTM RevPAR 平均变化幅度，便于快速计算 0.1-0.3 分降幅对应的精准收益损失；计算逻辑简单、代码实现门槛低、拟合效率高，无额外特征干扰，能直接聚焦 “整体评分 - 收益” 核心关联；同时可通过R²值快速评估模型拟合效果，严谨界定结果可靠性边界，适合业务侧快速理解和落地。
  - 缺点：假设评分与 RevPAR 存在线性关系，可能无法捕捉高评分区间的边际效应异质性；未纳入其他控制变量，无法分离清洁度、位置等维度评分的干扰，也无法捕捉评分与评论数量的特征交互效应；加之模型解释力有限（对应代码中R²≈0.0630），仅能提供近似参考，无法完全解释 RevPAR 的变异。
  - 适用场景：需要量化 “评分下降 - 收益损失” 直接关联、强调结果易解释且快速落地的敏感度分析场景，对应本项目核心代码实现的唯一模型。
  - 代码落地对应：已完成该模型的全流程实现，包括数据加载、模型拟合、斜率计算、敏感度遍历与 4.9→4.6 分差评场景模拟，并输出散点图、回归线可视化结果与量化结论，所有输出结果均来源于该单一模型。

  **说明与意义**
  本次分析仅通过一元线性回归模型得到 “通用型” 评分 - 收益敏感度，量化出评分下降 0.1-0.3 分对应的 RevPAR 损失，以及 4.9→4.6 分差评场景的具体影响，既保证核心结论的易解释性与选做任务达标，又呼应 “近似估计、非严格因果” 的关键前提。分段线性回归仅为理论层面的潜在优化方向，未进行实际模型搭建与运行，未来拓展代码实现后，可弥补线性假设的局限性，给出 “差评冲击” 的合理近似范围（而非单一数值），提升分析深度与实用性；同时，现有模型的R²=0.0630也能清晰界定结果边界，避免业务侧对估计结果的过度解读。

### 3.3 超参数设置与训练细节

#### 数据集划分
- **逻辑回归 & XGBoost**：
  - 总体 Train/Val/Test 比例：6:1:2（train+val：test = 80%：20%）
  - 在 train+val 集上进一步划分：验证集占 12.5%（即总体的 10%）
  - 采用分层随机划分（stratify），确保类别分布一致

#### 逻辑回归超参数
- `max_iter=1000`：最大迭代次数
- `random_state=42`：固定随机种子，确保结果可复现
- `class_weight='balanced'`：自动调整类权重，应对类不平衡问题
- 特征标准化：使用 `StandardScaler` 对训练集进行拟合，并对验证/测试集应用相同变换

#### XGBoost 超参数
- `n_estimators=100`：树的数量
- `max_depth=5`：树的最大深度，防止过拟合
- `learning_rate=0.1`：学习率
- `subsample=0.8`：样本采样比例
- `colsample_bytree=0.8`：特征采样比例
- `random_state=42`：固定随机种子
- `scale_pos_weight`：根据类分布自动设置，平衡正负样本权重
- `eval_metric='auc'`：评估指标

#### 训练环境与实现
- 使用的框架：`scikit-learn`（逻辑回归）、`xgboost`（XGBoost）、`scipy.stats`（Kruskal-Wallis检验）
- 环境：CPU 环境下训练（XGBoost 默认）
- 可视化库：`matplotlib`、`seaborn`

---

## 4. 实验设计与结果分析

### 4.1 数据集划分与评估指标

- 训练 / 验证 / 测试划分方式：
  - 分层随机划分，总体 Train/Val/Test 比例为 6:1:2
  - 在 train+val 集（80%）上进一步按 12.5% 分出验证集
  - 采用分层划分（stratify）确保各集合中正负样本比例一致
- 评价指标：
  - **分类任务（Model3）**：Accuracy（准确率）、Precision（精准率）、Recall（召回率）、F1-Score（F1分数）、AUC（ROC曲线下面积）
  - **相关性分析（Model1）**：Pearson相关系数 + p值显著性检验
  - **非参数检验（Model2）**：Kruskal-Wallis H统计量 + p值
  - **敏感度分析（Optional2）**：线性回归斜率、R²值

### 4.2 结果展示（表格与图形）

#### 4.2.1 相关性分析结果（Model1）

**整体评分与关键表现指标相关性**：
- 计算 `rating_overall` 与 `ttm_revpar`、`ttm_occupancy`、`ttm_revenue` 的 Pearson 相关系数及显著性
- 输出表格展示各指标的相关系数、p值及显著性判定

| 指标 | 评分维度 | 相关系数 | p值 | 显著性 |
|------|----------|----------|-----|--------|
| ttm_revpar | rating_overall | 0.25093965872934404 | 1.1650228424911417e-05 | 显著 |
| ttm_occupancy | rating_overall | 0.1835356861588996 | 0.0014622414587811322 | 显著 |
| ttm_revenue | rating_overall | 0.25095629363619404 | 1.1634171202828473e-05 | 显著 |

**各维度评分与表现指标相关性矩阵**：
- 六个具体评分维度（accuracy、checkin、cleanliness、communication、location、value）
- 五个表现指标（ttm_revpar、ttm_occupancy、ttm_revenue、l90d_revenue、l90d_occupancy）
- 生成 7×5 的相关系数矩阵，用热力图可视化，标注显著性水平
- 按相关系数大小排序，识别对 RevPAR 影响最大的评分维度

![相关性热力图](../data/model%201-correlation_heatmap.png)

**关键发现**：
- **在长期表现指标方面：** 各评分维度对房源表现绝大部分呈现出显著但普遍较弱的相关性。位置评分`rating_location`和清洁度评分`rating_cleanliness`对RevPAR的影响最为突出，相关系数均在0.216左右，说明这两个硬性条件直接决定了房源的收入水平。然而，一个有趣的发现是性价比评分`rating_value`对入住率的影响最大，这表明当客人认为房源"物有所值"时，更倾向于做出预订决策，直接提升了房源的预订频率。值得注意的是，入住体验评分`rating_checkin`对长期入住率的影响不显著，说明入住流程的顺畅性虽然是服务的一部分，但对客人是否重复预订或长期选择该房源的影响有限。
- **在短期表现指标方面：** 相关性模式与长期指标基本一致，但整体相关性系数略有降低。

> 综合来看，不同评分维度对房源表现的影响存在明显的差异化模式。位置和清洁度构成了房源的"硬实力"，主要驱动收入增长；而性价比则是影响客流量的关键杠杆，直接决定入住率水平。准确性、沟通和入住体验等软性服务维度虽然也有显著影响，但效应相对较弱，更多是作为满意度的补充因素。此外，长期与短期表现的相关性模式高度一致，说明这些影响关系具有稳定性，不是短期波动所致。

- 我们可以额外获得以下几方面的重要信息：  

  1. 各维度评分与整体评分之间的关系  
  - 由于整体评分是各维度评分的均值，理论上每个维度对整体评分的贡献权重应该相等。但实际数据中显示整体评分`rating_overall`与准确性评分`rating_accuracy`和性价比评分`rating_values`高度相关，说明整体评分高的房源，往往在性价比和描述准确性上表现突出，显著优于其他房源；而在清洁度、沟通等维度上，各房源间的评分差异可能较小，因此对区分整体评分高低的贡献较小。这反映了客人在给出总体评价时，最为看重房源描述是否真实可靠以及价格是否合理。  
  - 沟通评分`rating_communication`与入住体验评分`rating_checkin`之间也存在较强相关性（0.76），反映出良好的沟通往往能带来顺畅的入住体验。  
  - 位置评分与其他服务类评分维度相关性普遍较低，这表明地理位置作为客观属性，在客人的评价体系中相对独立，不受其他主观服务体验的影响。  

  2. 长短期表现指标高度一致：ttm_revpar与l90d_revenue相关系数达0.89，ttm_occupancy与l90d_occupancy相关系数为0.79，表明房源表现具有很强的时间持续性，短期业绩能有效预测长期趋势。

  3. 虽然评论数量`num_reviews`与各项评分均无显著正相关，与整体评分甚至呈现微弱负相关（-0.04），但其与入住率指标`occupancy`却显示出中等程度的相关性。这一矛盾现象说明评论数量主要反映房源的市场曝光度和运营活跃度，而非质量认可度。新上线的房源往往容易获得较高评分，随着评论数量的积累，评分会逐渐趋于真实平均水平。特别值得注意的是，评论数量仅与清洁度评分呈弱正相关，这暗示清洁度是相对客观且稳定的评价维度，而其他评价维度可能随着运营压力增加而出现质量波动。

#### 4.2.2 评分与评论量组合分析结果（Model2）

**分组阈值确定**：
- 评论数量分位数：Q25 = 50条，Q75 = 194条
- 评分分段阈值：4.5（较低分界），4.8（高分界）

**4类分组样本量统计**：
- 高评分+评论较多：28条（9.4%）
- 高评分+评论较少：40条（13.4%）
- 评分一般+评论较多：42条（14.1%）
- 评分较低+评论较少：10条（3.4%）
- 其他（不分析）：178条（59.7%）

**各组表现指标对比**（基于可视化图表分析）：

**TTM RevPAR 分布特征**：

![Model2 RevPAR Boxplot](../data/model%202-london_ttm_revpar_box.png)

- **高评分+评论较多**：RevPAR 中位数最高，分布相对集中，说明这类房源收益稳定且表现优异
- **高评分+评论较少**：RevPAR 中位数较高，但分布较分散，存在一定波动性，说明评论数量对收益稳定性有影响
- **评分一般+评论较多**：RevPAR 中位数中等，分布相对稳定，说明评论数量可以在一定程度上弥补评分的不足
- **评分较低+评论较少**：RevPAR 中位数最低，分布范围较窄，说明这类房源整体表现较差

**TTM Occupancy 分布特征**：

![Model2 Occupancy Violin](../data/model%202-london_ttm_occupancy_violin.png)

- **高评分+评论较多**：入住率中位数最高，分布集中，说明高评分和高评论量共同作用带来高入住率
- **高评分+评论较少**：入住率中位数较高，但分布较分散
- **评分一般+评论较多**：入住率中位数中等，说明评论数量对入住率有积极影响
- **评分较低+评论较少**：入住率中位数最低

**组间统计检验结果**：
- **TTM RevPAR 组间 Kruskal-Wallis 检验**：
  - H统计量 = 20.03
  - p值 = 0.00017 < 0.001
  - **结论**：拒绝原假设，不同"评分-评论量"组合房源的 RevPAR 中位数存在显著差异，差异具有统计学意义
  
- **TTM Occupancy 组间 Kruskal-Wallis 检验**：
  - H统计量 = 35.37
  - p值 < 0.001
  - **结论**：拒绝原假设，不同"评分-评论量"组合房源的入住率中位数存在显著差异，差异非常显著

**业务解读**：
1. **评论数量对高评分房源的重要性**：高评分+评论较多的房源表现最佳，说明即使评分很高，也需要足够的评论数量来建立市场信任。这类房源（28条，9.4%）是市场的标杆，值得平台重点推广。
2. **评论数量可以弥补评分不足**：评分一般+评论较多的房源表现优于高评分+评论较少的房源，说明评论数量可以在一定程度上弥补评分的不足。对于"高评分+评论较少"的潜力房源（40条，13.4%），平台可以提供运营支持，帮助其积累评论。
3. **双重劣势导致最差表现**：评分较低+评论较少的房源表现最差，说明评分和评论数量都是影响房源表现的重要因素。这类房源（10条，3.4%）需要房东重点关注和改进。

#### 4.2.3 基于评分与评论量的高收益房源预测模型（Model 3）

**高收益房源定义**：
- 以 ttm_revpar 指标的 top 25% 作为 “高收益房源” 标签，样本中高收益房源占比 25.3%，数据类别分布基本均衡。

**特征集与模型设置**：
- 输入特征：6个评分维度（rating_accuracy、rating_checkin、rating_cleanliness、rating_communication、rating_location、rating_value）+ 评论数量（num_reviews），共 7 个特征
- 模型参数：Logistic Regression：作为线性基线模型，设置max_iter=1000确保收敛，通过class_weight='balanced'平衡类别权重，特征标准化后训练，保证模型稳定性；Random Forest：作为树模型代表，配置n_estimators=100、max_depth=5、learning_rate=0.1，通过subsample=0.8和colsample_bytree=0.8抑制过拟合，同时用scale_pos_weight适配类别不平衡，训练中实时输出验证集AUC曲线变化。

**模型性能对比**：

| 模型                | Accuracy | Precision | Recall | F1分数 | AUC    |
|---------------------|----------|-----------|--------|--------|--------|
| Logistic Regression | 0.5667   | 0.3429    | 0.8000 | 0.4800 | 0.7185 |
| Random Forest       | 0.6667   | 0.3913    | 0.6000 | 0.4737 | 0.6756 |

**结果分析**：
- **准确率表现：** XGBoost 准确率（66.67%）较逻辑回归（56.67%）提升 10 个百分点，说明树模型对特征的拟合能力更优，能更好捕捉口碑特征与高收益的关联关系。
- **精确率与召回率权衡：** 逻辑回归召回率高达 80%，但精确率仅 34.29%，说明模型能有效识别高收益房源，但误判率较高；XGBoost 精确率提升至 39.13%，召回率降至 60%，实现了更均衡的判读效果。
- **AUC 指标：** 逻辑回归 AUC（0.7185）高于 XGBoost（0.6756），说明线性模型在高收益房源的排序能力上更具优势，二者各有侧重，印证了基线模型与进阶模型的互补性。

**特征重要性分析**：
- 结合特征系数图、特征重要性图及双轴对比图，从线性与非线性两个维度解析特征对高收益的影响，兼顾单一特征作用与多特征交互效应，形成全面的特征解读：
![逻辑回归-特征系数分析图](../data/model%203——逻辑回归_特征系数.png)

![XGBoost-特征重要性排序图](../data/model%203——XGBoost_特征重要性.png)

![特征权重双轴对比图](../data/model%203——特征权重对比.png)

**XGBoost 特征重要性排序（非线性贡献度）**：
  按综合贡献度从高到低排序，不区分影响方向，贴合多因素交互的业务场景：
  1. rating_location（位置评分）：贡献度最高，是房源高收益的核心硬性优势，与 Model1 相关性分析结论一致；
  2. rating_cleanliness（清洁度评分）：贡献度次之，作为基础服务指标，强力支撑高收益；
  3. num_reviews（评论数量）：位列第三，呼应 Model2 结论，是提升市场信任度、助力高收益的重要因素；
 其余特征（描述准确性、沟通质量、入住体验等）贡献度依次递减，仅为次要服务补充，对高收益无决定性作用；性价比评分虽重要性排名第四，但影响呈非线性，需结合核心特征综合判断，凸显树模型优势。

**逻辑回归系数分析（线性影响关系）**：
  结合逻辑回归-特征系数分析图，通过系数正负与绝对值，解读特征对高收益的线性影响方向与强度：
  1. 正向系数特征：沟通、位置、评论数量，数值越高，房源为高收益的线性概率越大，契合“位置越优、沟通越顺、评论越多越易高收益”的业务直觉；
  2. 负向系数特征：入住体验、性价比等，并非本身不利高收益，而是数据中存在“高评分但位置偏远、清洁度不足”的样本组合，导致线性模型拟合偏差，此矛盾可通过XGBoost非线性能力化解；
3.系数强度：位置与沟通评分的系数绝对值最大，线性驱动作用最显著，与非线性模型的核心特征判断相呼应。

**模型结论、可视化佐证与一致性验证**：
![逻辑回归与XGBoost混淆矩阵对比图](../data/model%203——混淆矩阵对比.png)

![模型三项核心指标对比图](../data/model%203——模型性能对比.png)

1. 与前文分析的一致性验证：
   核心特征一致：位置、清洁度评分在本模型中权重最高，与 Model1 相关性分析中对 ttm_revpar 影响最大的结论完全吻合，验证了核心影响因素的跨分析场景稳定性，说明地理位置与基础服务质量是驱动房源高收益的核心抓手。
   评论量价值一致：评论数量的重要性再次印证了 Model2 中“评论量可弥补评分不足”的发现，说明其对高收益的影响具有跨模型、跨分析维度的稳定性，是提升房源市场认可度的重要辅助因素。

2. 可视化新增核心发现：
   模型差异具象化：结合图5，XGBoost在准确率上较逻辑回归提升10个百分点（66.67% vs 56.67%），而逻辑回归AUC更高（0.7185 vs 0.6756），为场景化模型选择提供明确依据——若需“尽可能不漏判高收益房源”（如平台筛选潜力房源），可选择召回率达 80% 的逻辑回归；若需“降低误判、提升精准度”（如房东自我评估），则XGBoost更合适（精确率39.13%）。
   特征影响模式厘清：结合特征权重双轴对比图，清晰揭示线性与非线性模型的核心区别，解释了“性价比评分系数为负但重要性较高”的矛盾——这类特征对高收益的影响并非单一线性关系，需结合位置、清洁度等硬实力综合判断，凸显了树模型捕捉复杂关联的优势。


#### 4.2.4 评论爆发期分析方法与实现（optional1）

**经营指标量化对比结果**：

评论爆发期对房源经营指标具有显著的正向拉动作用，核心指标提升结果如下：
- ttm_revenue（12 个月滚动收入）：无爆发期均值 24537.42，有爆发期均值 45128.87，提升 83.92%，后者为前者的 1.84 倍，长期收入增长显著；
- ttm_occupancy（12 个月滚动入住率）：无爆发期均值 0.31，有爆发期均值 0.58，提升 87.10%，房源长期出租效率大幅提升；
- ttm_revpar（12 个月滚动每可用房收入）：无爆发期均值 67.23，有爆发期均值 123.64，提升 83.91%，房源长期收益效率同步增长；
- l90d_revenue（90 天收入）：无爆发期均值 4926.97，有爆发期均值 10430.55，提升 111.70%，短期收入增长幅度超过长期，爆发期影响更具即时性；
- l90d_occupancy（90 天入住率）：无爆发期均值 0.24，有爆发期均值 0.53，提升 120.83%，为所有指标中提升幅度最大项，短期出租热度显著攀升。
![1）评论爆发期房源 vs 非爆发期房源核心经营指标对比](../data/optional1-burst_vs_noburst_metrics.png)

**评论时间序列趋势结果**：

全量房源月度评论数呈现显著的阶段性波动特征：
- 2025 年 3 月 - 6 月，月度评论数呈持续快速上升趋势，从约 100 增长至 250+，2025 年 6 月达到全年评论峰值；
- 2025 年 6 月后，月度评论数逐步回落，整体呈现下行趋势，2025 年 11 月降至全年较低水平；
- 该趋势反映了房源评论的 “季节性 / 阶段性波动”，2025 年 3-6 月为全量房源的评论集中增长期，也是评论爆发期的高频出现阶段。
![模型三项核心指标对比图](../data/optional1-total_reviews-time_series.png)

**核心结论**：
- 明确了评论爆发期的科学定义：以 “房源月评论数均值 + 1.5 倍标准差” 为阈值，可有效识别具有统计显著性的评论激增月份，存在至少 1 个该类月份的房源即为 “有爆发期房源”；
- 验证了评论爆发期的正向价值：有爆发期房源的核心经营指标均实现 80% 以上的显著提升，其中短期指标（l90d 系列）提升幅度更高，说明评论爆发期对房源经营表现的拉动具有 “即时性强、长期持续” 的特点；
- 揭示了评论波动的阶段性规律：评论数的集中增长与爆发期的高频出现高度吻合，反映了市场关注度与房源经营表现的正向关联。


#### 4.2.5 “差评冲击”的敏感度分析（optional2）

**分析目标与方法**：
    本次分析基于线性回归模型，探究房源整体评分（rating_overall）下降对每间可售房收入（ttm_revpar）的影响幅度，核心目标包括两方面：一是量化评分每下降 0.1-0.3 分时 RevPAR 的平均变化；二是模拟具体差评场景（评分从 4.9 降至 4.6）的业务影响。分析过程中严格遵循要求，明确结果为基于统计相关性的近似估计，不代表严格因果关系。

**核心分析结果**：

1.评分下降的 RevPAR 敏感度：
  通过线性回归模型计算，评分下降与 RevPAR 减少呈现近似线性关联，具体敏感度如下：
- 评分下降 0.1 分：RevPAR 平均减少 12.00 英镑
- 评分下降 0.2 分：RevPAR 平均减少 23.99 英镑
- 评分下降 0.3 分：RevPAR 平均减少 35.99 英镑

**2.评分下降的 RevPAR 敏感度**：
    针对 “差评导致评分从 4.9 降至 4.6” 的场景（评分下降 0.3 分），模型估计结果显示：
- RevPAR 将减少 35.99 英镑，与评分下降 0.3 分的敏感度结果完全一致，验证了线性关联的稳定性。

**3.评分下降的 RevPAR 敏感度**：
    线性回归模型的决定系数 R²=0.0630，表明整体评分仅能解释 RevPAR 变异的 6.3%。这一数值反映出模型拟合程度有限，RevPAR 的变化还受到房源位置、设施配置、定价策略等其他未纳入模型的因素影响。

**核心分析结果**：

**1.结果的业务参考价值**：
  从数值结果来看，评分下降对 RevPAR 存在明显的负向关联：每 0.1 分的评分下滑对应约 12 英镑的 RevPAR 损失，0.3 分的下滑则可能导致近 36 英镑的收入减少。对于高评分房源（如 4.9 分）而言，此类差评带来的收入冲击相对显著，凸显了维护用户评价的重要性。

**2.关键局限性说明**：

    1.因果关系限制：本分析仅基于变量间的统计相关性，无法证明 “评分下降直接导致 RevPAR 减少”。实际中可能存在反向因果（如 RevPAR 相关的服务质量问题导致差评）或第三方变量干扰。

    2.模型解释力不足：R²=0.0630 表明模型对 RevPAR 的解释能力较弱，未纳入的关键变量可能导致估计结果存在偏差。
    
    3.线性假设局限：模型假设评分与 RevPAR 呈线性关系，但实际场景中不同评分区间的敏感度可能存在差异（如高评分区间的下降影响更显著）。

**3.可视化结果辅助解读**：
    分析过程中生成的可视化图表清晰呈现了样本分布、回归线及差评场景位置：蓝色散点代表各房源的实际数据，红色虚线为线性回归线，橙色星标标注了 4.9 分至 4.6 分的差评场景转换。图表直观显示了两者的正向关联趋势，同时也反映出数据点的离散程度较高，进一步印证了模型解释力有限的结论：
    ![差评冲击敏感度分析图](../data/optional2-差评冲击分析.png)
>本分析通过线性回归模型完成了 “差评冲击” 的近似敏感度估计，量化了评分下降对 RevPAR 的潜在影响，为房源运营中的评价管理提供了参考依据。但需重点强调，由于模型解释力有限且仅反映相关性，结果不能作为严格的因果结论应用于实际决策。未来若需更精准的分析，可纳入更多控制变量（如房源类型、地理位置、竞争环境等），或采用更复杂的计量模型以减少潜在偏差。

### 4.3 结果分析与业务解读

**对两个模型表现的分析**：

- **模型效果对比**：
  - **准确率**：XGBoost（0.6667）高于逻辑回归（0.5667），提升约10个百分点
  - **F1分数**：逻辑回归（0.4800）略高于XGBoost（0.4737），差异很小
  - **AUC值**：逻辑回归（0.7185）高于XGBoost（0.6756），说明逻辑回归在整体区分能力上略优
  - **综合分析**：XGBoost在准确率上更优，但逻辑回归在AUC值上更优，两者各有优势。逻辑回归模型在非高收益房源识别上表现较好（精确率 0.88），但在高收益房源识别上召回率较高（0.80）但精确率较低（0.34）。XGBoost在非高收益房源识别上精确率为0.84，召回率为0.69；在高收益房源识别上精确率为0.39，召回率为0.60。

- **过拟合/欠拟合判断**：
  - 验证集 F1分数（0.4444）与测试集 F1分数（0.4800）接近，未出现明显过拟合
  - 模型表现中等，可能存在一定欠拟合，可能与样本量较小（298条）和特征数量有限有关

**高收益房源特征画像**：
根据特征系数/重要性分析，描述高收益房源的典型特征：
- 评论数量水平：较多（如50+）
- 清洁度评分：偏高（4.8+）
- 位置评分：优越（4.8+）
- 性价比评分：合理（4.7+）
- 沟通评分：主动（4.8+）

**可操作的建议**：
1. **对房东的建议**：
   - 优先关注清洁度和位置评分，这两项权重最高
   - 积极回应房客评论，提升沟通评分
   - 合理定价，提高性价比评分
   
2. **对平台的建议**：
   - 将"高评分+高评论量"的房源作为标杆，优先推荐
   - 为"高评分+低评论量"的房源提供运营指导，帮助积累评论
   - 向低评分房源提供改进建议或扶持政策
   
3. **模型应用**：
   - 使用预测模型定期评估房源是否具备高收益潜质
   - 结合业务直觉调整阈值（如从 Top 25% 调为 Top 20%）

---

## 5. 结论与不足

### 5.1 主要结论

**基于三个递进式模型的关键发现**：

1. **评分维度对收益的影响存在显著差异**（Model1）：
   - 不同维度的评分与 TTM RevPAR 的相关系数差异明显
   - 位置评分、清洁度评分等维度对收益的影响更显著
   - 相关性分析提供了评分与表现的基准量化关系

2. **评论数量与评分的联合效应显著**（Model2）：
   - Kruskal-Wallis 检验结果（p < 0.001）表明四类房源的表现在统计学上差异极显著
   - "高评分+高评论量"的房源表现最优，是市场标杆
   - "评分一般+高评论量"的房源表现优于"高评分+低评论量"，说明评论数量的补偿效应存在

3. **机器学习模型对高收益房源的预测能力**（Model3）：
   - 逻辑回归和XGBoost 两个模型的性能对比体现了线性与非线性关系的权衡
   - 特征重要性排序与相关性分析的结论基本一致，提升了结论的可靠性
   - 模型可用于平台评估新房源是否具备高收益潜质

4. **实践应用价值**：
   - 房东可根据特征画像有针对性地提升口碑评分
   - 平台可通过四象限分类对房源进行差异化运营
   - 新房源的前期运营应兼顾评分和评论量的积累

5. **关键局限**（重要提示）：
   - 相关性分析反映的是 **统计关联而非因果关系**
   - 本项目结论基于伦敦单一城市数据，地域适用性需进一步验证

### 5.2 不足与改进方向

**数据层面的不足**：
- 样本量有限（298条有效房源），可能影响模型泛化能力
- 缺乏其他城市数据，无法验证结论的跨地域适用性
- 缺失房源的动态信息（如价格变化、运营策略调整等）
- 评论文本的情感信息未被充分利用，仅使用数值评分维度

**方法层面的不足**：
- 相关性分析假设线性关系，可能遗漏复杂的非线性关系
- Model2 的四象限分类为离散化处理，部分信息丧失
- 分类模型未考虑时间序列信息，无法捕捉房源动态变化
- 未进行特征间的交互项工程和多重共线性诊断

**未来可以尝试的改进方向**：
- **数据扩展**：融合多个城市的数据，进行跨城市对比分析，提升模型泛化性
- **时间维度**：将评论爆发期、评分变化轨迹纳入模型，进行时间序列预测
- **文本分析**：使用NLP技术对评论文本进行情感分析，提取隐含的质量信号
- **因果推断**：使用因果推断方法（如倾向匹配、双重差分）验证评分变化对收益的因果影响
- **更复杂模型**：尝试神经网络、集成学习等高级模型，进一步提升预测精度
- **A/B测试**：基于模型建议对房源进行干预（如定价调整、评论促进活动），在实际环境中验证效果

---

## 6. 小组协作与个人收获

### 6.1 分工与协作情况

**小组整体的合作方式**：
- **GitHub 协作**：
  - 使用私有仓库进行代码管理和版本控制
  - 每位成员在自己的分支上进行开发，通过 Pull Request 合并到主分支
  - 提交信息遵循规范格式（如：`feat: add xgboost model`、`fix: handle missing values`）
  
- **沟通与协调**：
  - 定期召开线上会议，讨论项目进展和遇到的问题
  - 使用微信群进行日常沟通和文件共享
  - 遇到技术分歧时，通过代码实验对比不同方案的效果，选择最优方案
  - 重要决策（如模型选择、特征工程方案）通过小组讨论达成一致

### 6.2 个人收获

> 建议每位同学单独成段，写明本次项目中学到的内容与反思。

- **学生 1（杨颖）**
我主要负责**数据处理**全流程和**选做一（评论时间序列与爆发期分析）** 的实现工作。在数据处理工作中，我深入理解了数据预处理的核心逻辑，学会了如何针对Listings Data和Reviews Data进行数据清洗、字段筛选、缺失值填充与异常值过滤，通过封装`load_and_filter_listings()、preprocess_reviews_data()、associate_listings_and_reviews()、clean_core_indicators()`等模块化函数，将繁琐的数据处理步骤拆解为可复用的单元。在选做一的实现过程中，我掌握了时间序列分析的基本方法，学会了如何基于评论日期提取月度维度数据、计算房源评论爆发期阈值，并成功识别出存在评论爆发期的房源。通过实现`plot_monthly_reviews_time_series()、define_review_burst_period()、analyze_burst_metrics_impact()`等函数，我熟练运用pandas进行分组统计与数据关联，同时掌握了matplotlib绘制图像的技巧，清晰呈现了评论爆发期与房源ttm_revenue、l90d_occupancy等经营指标的关联关系。在整个工作过程中对于数据关联不匹配、日期格式混乱、大规模数据处理效率低下等挑战逐一解决，这让我对 Python 数据处理库的使用细节有了更深入的理解。此外，我也熟练掌握了 Git 的基础操作，与团队进行分工合作。这次项目不仅提升了我的数据处理与可视化能力，更让我对完整的数据分析项目流程有了全面的认知，受益匪浅。

- **学生 2（洪莹霖）**
我主要负责**模型一（房源级相关性分析）**的实现和**代码整合和debug**工作。在模型一的实现过程中，我深入理解了Pearson相关系数在房源评分与经营表现之间的应用，学会了如何计算相关系数并通过p值判断统计显著性，从而区分真实关联与随机波动。通过实现相关性热力图和特征排序条形图，我掌握了如何使用seaborn和matplotlib进行多维数据的可视化展示，使复杂的相关性关系一目了然。在代码整合工作中，我将多个notebook中的分析逻辑重构为模块化函数，包括`analyze_correlation_overall_rating()`、`analyze_correlation_all_dimensions()`、`plot_correlation_heatmap()`等，并通过系统化的单元测试确保各模块的正确性。在debug过程中，我遇到了数据类型转换、缺失值处理、异常数据过滤等多个挑战，通过详细的print输出和分阶段验证逐一解决，这使我对Python数据处理的细节有了更深的认识。此外，我学会了如何设计清晰的模块接口，使上层的main.py能够透明地调用各类分析功能，这对于提升代码可维护性和可扩展性至关重要。此外这次项目也让我熟练掌握了如何利用vs code和命令行来推送和下来git，并深入了解了github这个网站（以前只知道这是一个代码托管网站，注册账号后都没有好好的利用这个平台）。虽然这次项目在完成过程中遇到许多困难，但也是让我真正了解了一个项目是怎么在团队协作里面搭建起来的。

- **学生 3（周琼）** 
我主要负责**模型二（评分与评论量组合分析）**的实现和**参与代码整合**工作。在模型二的实现过程中，我深入理解了象限分析法的应用，学会了如何基于分位数构造特征组合分组，并使用Kruskal-Wallis检验进行组间差异的统计验证。通过实现小提琴图和箱型图的绘制函数，我掌握了如何选择合适的可视化工具来展示不同数据分布特征。在代码整合工作中，我将notebook中的分析代码重构为模块化的Python函数，封装在`src/utils.py`中，包括`analyze_rating_reviews_combination()`、`create_four_group_classification()`、`plot_violin_by_group()`、`plot_box_by_group()`、`perform_group_statistical_test()`等函数。通过编写`src/main.py`，我学会了设计统一的命令行接口，并支持通过`--task`参数选择运行不同的分析任务，使项目能够一键运行。在代码重构过程中，我懂得了如何处理不同数据路径、异常情况，提高了代码的健壮性和可维护性。此外，我还了解了使用Git进行版本控制，通过分支管理和Pull Request进行代码协作，这次的任务使我受益匪浅。

- **学生 4（余昕恬）**
我主要负责**模型三（高收益房源分类预测模型）** 与**选做二（“差评冲击”敏感度分析）** 的实现。
在Model3中，我理解了逻辑回归与XGBoost的核心差异，掌握分类任务工程化流程（特征标准化、分层数据划分、超参数调优、多指标评估）。通过对比Accuracy、F1、AUC等指标，明确线性与树模型的性能权衡，同时通过特征重要性可视化，验证核心特征稳定性，解释了线性模型中“性价比评分系数为负”的拟合矛盾。在选做二中，我运用线性回归量化评分与RevPAR的关联，得出评分下降0.1-0.3分的收益损失，模拟了“4.9分降至4.6分”的差评场景影响。过程中学会用R²评估模型解释力，严谨区分统计关联与因果关系，并通过Matplotlib完成可视化，提升结果直观性。此外，我将模型逻辑重构为`train_logistic_regression()`等模块化函数，保障代码可复用性。通过同步团队开发规范，熟练运用Git进行版本控制，深刻体会协作中代码规范化的重要性。项目让我熟练掌握scikit-learn、XGBoost框架，深化机器学习核心认知，提升了业务问题转化与数据洞察提炼的实践能力。

---

## 7. 附录

### 7.1 主要代码结构说明

项目目录结构如下：

```
ml-course-project-2025-aaaaa/
├── data/                          # 数据目录
│   ├── cleaned.csv                # 清洗后的数据
│   ├── london-reviews.csv         # 评论数据（选做任务）
│   ├── data_boxplot.png           # EDA箱型图
│   ├── model.png                  # 模型1、2、3相关图表
│   ├── optional.png               # 选做1、2相关图表
│   └── README.md                  # 数据说明文档
├── notebooks/                     # Jupyter Notebook分析文件
│   ├── EDA.ipynb                  # 数据探索性分析
│   ├── model1.ipynb               # 房源级相关性分析
│   ├── model2.ipynb               # 评分与评论量组合分析
│   ├── model3.ipynb               # 分类模型（逻辑回归+XGBoost）
│   ├── optional1.ipynb            # 选做任务1：评论爆发期分析
│   ├── optional2.ipynb            # 选做任务2：差评冲击分析
│   └── README.md                  # Notebook说明文档
├── src/                           # 源代码目录
│   ├── main.py                    # 主程序入口：一键运行所有分析
│   └── utils.py                   # 工具函数：数据清洗、模型训练、可视化
├── reports/                       # 报告目录
│   └── report_template.md         # 项目报告（本文档）
├── projects/                      # 课题说明文档（只读）
│   └── project4_*.md              # 课题4说明文档
├── requirements.txt               # Python依赖列表
└── README.md                      # 项目总说明文档
```

