# 机器学习课程设计项目报告

## 1. 项目基本信息

- **小组编号**：[待填写]
- **课题名称**：城市市场细分与房源聚类
- **数据预处理范围**：London, Tokyo, Paris, Seoul, Rio de Janeiro（五个城市，共1492条房源记录）
- **聚类分析范围**：London（300条房源记录）
- **选定时间范围**：使用全部可用数据
- **所用数据表**：Listings Data（房源静态特征 + 历史表现字段）
- **项目 Github 仓库地址**：https://github.com/ZJUT-CS/ml-course-project-2025-kaggle

### 1.1 小组成员与角色分工（固定 4 人）

| 成员   | 姓名 | 学号 | GitHub 用户名 | 主要负责内容（简要）      |
|--------|------|------|---------------|---------------------------|
| 学生1 | 李兴业 | 302023562058 | weimengxingye | 数据 & EDA 负责人 |
| 学生2 | 林华宝 | 302023562065 | letusgoj | 模型 & 评估负责人 |
| 学生3 | 黄江善 | 302023562001 | Eldnac | 代码负责人& 展示负责人 |
| 学生4 | 孙榕泽 | 302023562024 | cax1as | 报告撰写 & 展示负责人 |

---

## 2. 问题背景与数据集说明

### 2.1 业务背景与研究问题

Airbnb 作为全球领先的短租平台，连接了数百万房东和房客。在同一个城市中，Airbnb 房源并不是"同质"的：
- 有的主打高价核心商圈小户型，面向商务短住需求；
- 有的适合家庭度假，提供大户型和完善设施；
- 有的承担长期低价住宿需求，面向预算有限的旅客。

**核心问题**：
本项目是一个**聚类/画像任务**，旨在利用无监督学习算法，将城市内房源划分为若干"类型 / 细分市场（segment）"，并给每一类起一个业务上可理解的名字。

**研究价值**：
- **对平台**：了解市场结构，优化房源推荐策略，制定差异化运营方案
- **对房东**：了解自身房源定位，制定合适的定价策略，优化房源配置
- **对房客**：更好地匹配需求，找到符合期望的房源类型

### 2.2 数据来源与筛选规则

**数据来源**：
- AirROI Data Portal：https://www.airroi.com/data-portal/
- 具体城市数据链接：
  - London: https://www.airroi.com/data-portal/markets/london-united-kingdom
  - Tokyo: https://www.airroi.com/data-portal/markets/tokyo-japan
  - Paris: https://www.airroi.com/data-portal/markets/paris-france
  - Seoul: https://www.airroi.com/data-portal/markets/seoul-south-korea
  - Rio de Janeiro: https://www.airroi.com/data-portal/markets/rio-de-janeiro-brazil

**所使用的数据表**：
- **Listings Data**：房源静态特征 + 近 90 天 / 过去一年表现字段
  - 包含房源基本属性、评分、价格、表现指标等

**样本量与筛选条件**：

| 城市 | 初始样本量 | 原始字段数 |
|------|-----------|-----------|
| London | 300 | 62 |
| Tokyo | 297 | 62 |
| Paris | 298 | 62 |
| Seoul | 300 | 62 |
| Rio de Janeiro | 297 | 62 |

**数据使用说明**：
- **数据预处理阶段**：对五个城市（London, Tokyo, Paris, Seoul, Rio de Janeiro）的数据进行了统一的预处理，包括特征选择、缺失值处理、异常值处理、编码和标准化
- **聚类分析阶段**：由于时间和资源限制，本项目主要使用 **London** 的数据进行聚类分析和市场细分
- **特征筛选原则**：站在客户角度，选择与住宿体验、使用门槛、环境感知密切相关的特征，剔除与房东收益或运营无直接关联的变量

**核心特征说明**（共约 25 个特征）：

1. **房源基本类型**（7个）：
   - `listing_type`：房源物理形态（如 Entire home, Private room 等）
   - `room_type`：入住空间类型（entire_home, private_room, hotel_room）
   - `guests`：可容纳人数
   - `bedrooms`：卧室数
   - `beds`：床位数
   - `baths`：浴室数
   - `photos_count`：照片数量

2. **房东与服务特征**（3个）：
   - `superhost`：是否为超级房东
   - `instant_book`：是否支持即时预订
   - `professional_management`：是否专业管理

3. **入住规则与费用**（3个）：
   - `min_nights`：最少入住天数
   - `cleaning_fee`：清洁费
   - `cancellation_policy`：取消政策（Flexible, Moderate, Firm, Strict 等）

4. **用户反馈与评分体系**（7个）：
   - `num_reviews`：评论数量
   - `rating_overall`：总体评分
   - `rating_accuracy`：准确性评分
   - `rating_checkin`：入住体验评分
   - `rating_cleanliness`：清洁度评分
   - `rating_communication`：沟通评分
   - `rating_location`：位置评分
   - `rating_value`：性价比评分

5. **市场表现指标**（5个）：
   - `ttm_avg_rate`：过去12个月平均价格
   - `ttm_occupancy`：过去12个月入住率
   - `ttm_revpar`：过去12个月每间可售房收入（RevPAR）
   - `l90d_avg_rate`：近90天平均价格
   - `l90d_occupancy`：近90天入住率

6. **地理位置**（2个）：
   - `latitude`：纬度
   - `longitude`：经度

### 2.3 预期目标与分析思路

**预期输出**：
1. 使用聚类算法（KMeans + GMM）将房源划分为若干细分市场
2. 通过轮廓系数（KMeans）和 BIC/AIC（GMM）等指标选择最优聚类数 k/组件数
3. 对每个 cluster 进行特征分析，总结关键特征
4. 为每个 cluster 给出业务可理解的名字（如"高价核心商圈小户型"、"家庭度假型大户型"等）
5. 通过可视化展示聚类结果：
   - 箱线图/柱状图展示各 cluster 在关键特征上的差异
   - 地理位置可视化，在地图上用不同颜色标示不同 cluster

**技术路径**：
1. **数据预处理**：特征选择 → 缺失值处理 → 异常值处理 → 编码 → 标准化
2. **聚类建模**：KMeans + GMM（高斯混合模型）→ 轮廓系数/BIC/AIC评估 → 选择最优 k/组件数
3. **结果分析**：统计每个 cluster 的特征 → 可视化 → 业务解读与命名

---

## 3. 方法与模型设计

### 3.1 数据预处理与特征工程

#### 3.1.1 原始数据规模

五个城市的原始数据规模如下：

| 城市 | Listings 数据规模 | Calendar Rates 数据规模 | 说明 |
|------|------------------|----------------------|------|
| London | 300 × 62 | 3384 × 14 | 62个原始字段，包含房源静态特征和历史表现 |
| Tokyo | 297 × 62 | - | 数据来源为平台原始抓取数据，存在一定比例缺失值 |
| Paris | 298 × 62 | 3432 × 14 | 处理流程与London、Tokyo保持一致 |
| Seoul | 300 × 62 | 3516 × 14 | 字段结构与London、Tokyo、Paris保持一致 |
| Rio de Janeiro | 297 × 62 | 3372 × 14 | 包含房源基本属性、质量评价、价格与经营指标等多维信息 |

**数据特点**：
- 所有城市的数据均来自 AirROI Data Portal
- 数据存在一定比例的缺失值和字段质量不一致问题，属于典型的真实世界住房市场数据
- Calendar Rates 数据用于提取 `min_nights_avg` 字段，该字段缺失比例在 7-10% 之间

#### 3.1.2 特征选择

基于客户视角，我们选择了与住宿体验、使用门槛、环境感知密切相关的特征，共约 25 个核心特征，涵盖：

**特征分类**：
- **房源基本类型**：`listing_type`, `room_type`, `guests`, `bedrooms`, `beds`, `baths`, `photos_count`
- **房东与服务特征**：`superhost`, `instant_book`, `professional_management`
- **入住规则与费用**：`min_nights`, `cleaning_fee`, `cancellation_policy`
- **用户反馈与评分体系**：`rating_overall`, `rating_accuracy`, `rating_checkin`, `rating_cleanliness`, `rating_communication`, `rating_location`, `rating_value`, `num_reviews`
- **市场表现指标**：`ttm_avg_rate`, `ttm_occupancy`, `ttm_revpar`, `l90d_avg_rate`, `l90d_occupancy`
- **地理位置信息**：`latitude`, `longitude`

**选择原则**：
- 站在客户角度考虑，只选择客户最关心的因素
- 剔除了与房东收益或运营无直接关联的变量
- 房东是否赚钱与本研究无关，因此重点关注住宿体验相关特征

#### 3.1.3 缺失值处理

对不同类型变量采用分类处理策略：

**数值型特征**：采用**中位数填补**
- 原因：中位数对极端值不敏感，能更好地保持数据分布
- 处理的字段：`guests`, `bedrooms`, `beds`, `baths`, `cleaning_fee`, `photos_count`, `num_reviews`, 各类评分等

**类别型与二元变量**：采用**众数填补**
- 原因：保持样本分布的稳定性，避免引入新的类别
- 处理的字段：`superhost`, `instant_book`, `professional_management`, `cancellation_policy` 等
- 特殊处理：当 `mode()` 为空时，使用 "Unknown" 作为默认值

**各城市缺失情况**：

| 城市 | 主要缺失字段及比例 |
|------|-------------------|
| London | guests (43-45%), bedrooms (43-45%), instant_book, professional_management |
| Tokyo | instant_book (39%), bedrooms (30%), guests (26%), professional_management (7.7%) |
| Paris | instant_book (27.18%), professional_management (25.50%), bedrooms (16.78%), cleaning_fee (9.40%), guests (9.06%) |
| Seoul | bedrooms (44.33%), guests (37.00%), instant_book (34.33%), professional_management (19.67%) |
| Rio de Janeiro | instant_book (27.61%), bedrooms (23.23%), professional_management (19.19%), guests (18.86%) |

#### 3.1.4 异常值处理

使用 **IQR（四分位距）方法**进行异常值检测与截断处理：

**方法**：
- 计算第一四分位数（Q1）和第三四分位数（Q3）
- IQR = Q3 - Q1
- 下界 = Q1 - 1.5 × IQR
- 上界 = Q3 + 1.5 × IQR
- 将超出上下界的数据截断到边界值

**处理的字段**：
- `photos_count`：照片数量
- `num_reviews`：评论数量
- `min_nights`：最少入住天数
- `cleaning_fee`：清洁费
- `ttm_revpar`：RevPAR

**优势**：通过对极端值进行上下限裁剪，而非简单删除样本，有效减少了异常数据对距离度量和聚类结果的干扰，同时保留了样本完整性。

#### 3.1.5 特征编码

**1. Amenities 字段处理**：
- 原始格式：文本字符串，如 `"WiFi,Kitchen,Washer,Air conditioning"`
- 处理方法：转换为设施数量特征 `amenities_count`
- 计算方式：按逗号分割后统计数量
- 示例：`"WiFi,Kitchen,Washer"` → `amenities_count = 3`
- **说明**：原始数据中 amenities 字段包含大量具体设施名称（如 "Children's books and toys" 等家庭友好设施），如果进行 One-Hot 编码会产生过多特征列。为简化特征空间，统一转换为设施数量特征，既保留了设施丰富度的信息，又避免了维度爆炸问题。

**2. One-Hot 编码**：

对以下类别特征进行 One-Hot 编码，将每个类别值转换为独立的二值特征列：

- **listing_type**（房源类型）：
  - 编码为多个二值列，如 `listing_type_Entire home`, `listing_type_Private room` 等
  - 每个样本仅在其中一列取值为 1，其余为 0

- **room_type**（房间类型）：
  - `room_type_entire_home`, `room_type_private_room`, `room_type_hotel_room`

- **cancellation_policy**（取消政策）：
  - `cancellation_policy_Flexible`, `cancellation_policy_Moderate`, `cancellation_policy_Firm`, `cancellation_policy_Strict`, `cancellation_policy_Super Strict 60 Days`

- **布尔变量显式编码**：
  - `superhost`: `superhost_True`, `superhost_False`
  - `instant_book`: `instant_book_True`, `instant_book_False`
  - `professional_management`: `professional_management_True`, `professional_management_False`
  - `registration`: `registration_False`

**编码原因**：
- 避免人为赋予类别顺序或数值大小
- 保证特征表达的客观性
- 避免模型将布尔变量隐式当作连续数值处理
- 提高特征含义的可解释性

#### 3.1.6 多重共线性检测

基于 Pearson 相关系数矩阵，对数值特征间的线性相关性进行了检测。

**发现的高度相关特征对**（|r| > 0.8）：

| 城市 | 高度相关特征对 | 相关系数 |
|------|---------------|---------|
| London | rating_overall ↔ rating_accuracy, rating_communication, rating_value | > 0.8 |
| | ttm_avg_rate ↔ l90d_avg_rate | > 0.8 |
| Paris | rating_overall ↔ rating_accuracy, rating_value | > 0.8 |
| | guests ↔ beds | > 0.8 |
| | ttm_avg_rate ↔ l90d_avg_rate | > 0.8 |
| Seoul | rating_overall ↔ rating_accuracy, rating_cleanliness, rating_value | > 0.8 |
| | ttm_avg_rate ↔ l90d_avg_rate | > 0.8 |
| | ttm_occupancy ↔ l90d_occupancy | > 0.8 |
| Rio de Janeiro | rating_overall ↔ rating_accuracy | 0.808 |
| | rating_overall ↔ rating_value | 0.802 |
| | rating_accuracy ↔ rating_value | 0.844 |
| | ttm_avg_rate ↔ l90d_avg_rate | 0.864 |
| | ttm_occupancy ↔ l90d_occupancy | 0.834 |

**处理说明**：
- 这些高度相关的特征在后续 PCA 降维时可以重点关注
- 聚类算法对多重共线性相对不敏感，但降维时需要考虑

#### 3.1.7 Calendar Rates 数据处理

从 Future Calendar Rates 数据中提取 `min_nights_avg` 字段：

| 城市 | Calendar Rates 数据规模 | min_nights_avg 缺失比例 | 处理方式 |
|------|----------------------|---------------------|---------|
| London | 3384 × 14 | - | 中位数填充 |
| Paris | 3432 × 14 | 9.76% | 中位数填充 |
| Seoul | 3516 × 14 | 8.19% | 中位数填充（中位数=3.0） |
| Rio de Janeiro | 3372 × 14 | 7.15% | 中位数填充（中位数=3.00） |

该字段反映了房源的平均最少入住天数要求，是影响客户选择的重要规则特征。

#### 3.1.8 数据标准化

考虑到不同特征量纲差异较大，对最终用于聚类的特征进行了 **Z-score 标准化**。

**标准化公式**：
```
z = (x - μ) / σ
```
其中 μ 为均值，σ 为标准差。标准化后特征均值为 0，标准差为 1。

**不标准化的特征**（保持原始含义）：
- `listing_id`：房源标识符
- `latitude`, `longitude`：地理位置坐标（保持原始坐标值）
- `guests`, `bedrooms`, `beds`, `baths`：规模特征（保持原始数值含义）

**标准化原因**：
- 不同特征量纲差异大（如价格可能是 100-500，评分是 1-5）
- 聚类算法（如 KMeans）基于欧氏距离，标准化可避免大数值特征主导距离计算
- 确保所有特征在聚类时具有同等重要性

#### 3.1.9 数据输出

处理后的数据生成三个版本：
1. **base 版本**：只使用"静态属性 + 口碑"（规模、设施、评分），不包含表现指标（RevPAR、occupancy）
2. **with_revpar 版本**：在 Base 基础上加入 RevPAR 表现指标（`ttm_revpar`）
3. **with_occupancy 版本**：在 Base 基础上加入 Occupancy 表现指标（`ttm_occupancy`）

**数据保存方式**：
- 处理后的数据已上传至百度网盘，便于后续建模使用
- 网盘链接和提取码见 `data/README.md`
- 包含处理后的五个城市数据（chulihou/updated data）和原始数据（source data）

---

### 3.2 模型选择与设计

本项目使用了两种聚类方法对 London 房源数据进行聚类分析：

#### 3.2.1 KMeans 聚类

**选择原因**：
- 简单高效，计算速度快，适合当前数据规模（约300样本）
- 易于解释和理解，聚类结果直观
- 特征已标准化，满足 KMeans 对数据分布的要求

**优缺点**：
- **优点**：
  - 算法简单，实现容易
  - 计算效率高，适合中等规模数据
  - 结果易于解释，每个样本明确属于一个簇
- **缺点**：
  - 需要预先指定 k 值
  - 对初始值敏感，可能陷入局部最优
  - 假设簇为球形，对非球形簇效果不佳

**适用性**：适合当前数据规模（约300样本/城市），特征已标准化，且数据分布相对均匀。

#### 3.2.2 高斯混合模型（GMM）

**选择原因**：
- 可以处理非球形簇，比 KMeans 更灵活
- 提供概率分配，可以量化样本属于各簇的概率
- 使用 BIC/AIC 准则自动选择最优组件数，无需手动指定 k
- 作为 KMeans 的补充，验证聚类结果的稳定性和一致性

**优缺点**：
- **优点**：
  - 可以处理任意形状的簇（通过协方差矩阵）
  - 提供软分配（概率），更灵活
  - 有理论基础的模型选择方法（BIC/AIC）
- **缺点**：
  - 计算复杂度较高
  - 需要假设数据服从高斯分布
  - 对初始值敏感

**适用性**：作为 KMeans 的补充方法，用于验证聚类结果的稳定性和发现非球形簇结构。

#### 3.2.3 PCA 降维（辅助可视化）

**选择原因**：
- 高维特征（One-Hot 编码后特征维度较高）不利于直接可视化
- PCA 可以保留主要信息的同时降低维度
- 降维到 2D 后可以直观展示聚类结果

**实现**：使用 scikit-learn 的 PCA，将高维特征降维到 2 维（PC1, PC2），保留主要方差信息。

---

### 3.3 超参数设置与训练细节

#### 3.3.1 KMeans 超参数

**关键超参数**：
- `n_clusters = 4`：聚类数量，通过轮廓系数方法选择
- `random_state = 42`：随机种子，确保结果可复现
- `n_init = 10`：初始化次数，选择最优初始值

**最优 k 值选择方法**：
- 使用**轮廓系数（Silhouette Score）**评估不同 k 值的聚类质量
- 测试范围：k = 2 到 10
- 选择轮廓系数最高的 k 值作为最优聚类数
- 最终选择：**k = 4**（轮廓系数最高）

**实现框架**：scikit-learn `KMeans`

#### 3.3.2 GMM 超参数

**关键超参数**：
- `n_components = 4`：混合组件数量，通过 BIC/AIC 准则选择
- `covariance_type = 'full'`：协方差类型，允许每个组件有独立的协方差矩阵
- `random_state = 42`：随机种子，确保结果可复现

**最优组件数选择方法**：
- 使用 **BIC（Bayesian Information Criterion）** 和 **AIC（Akaike Information Criterion）** 评估不同组件数的模型质量
- 测试范围：n_components = 1 到 10
- 选择 BIC/AIC 最优的组件数
- 最终选择：**n_components = 4**

**实现框架**：scikit-learn `GaussianMixture`

#### 3.3.3 PCA 超参数

**关键超参数**：
- `n_components = 2`：降维后的维度数，用于可视化
- 数据预处理：使用 `StandardScaler` 进行 Z-score 标准化

**方差解释**：PC1 和 PC2 的方差解释比例会在可视化中显示，用于评估降维效果。

#### 3.3.4 训练环境

- **框架**：scikit-learn（sklearn）
- **Python 版本**：Python 3.x
- **主要依赖**：pandas, numpy, matplotlib, seaborn, geopandas

---

## 4. 实验设计与结果分析

### 4.1 数据集划分与评估指标

**数据集划分**：
- 本项目为无监督学习任务，不需要传统的训练/验证/测试划分
- 使用全部处理后的数据进行聚类分析

**评估指标**：
- **轮廓系数**：衡量聚类质量，范围 [-1, 1]，值越大越好
- **组内/组间差异**：通过统计每个 cluster 在关键特征上的均值/中位数/分布来评估
- **定性评估**：检查是否出现所有 cluster 特征分布非常接近，或某些 cluster 样本数极少的情况

---

### 4.2 结果展示（表格与图形）

#### 4.2.1 聚类质量评估指标

基于 PCA 降维后的二维空间进行聚类质量评估，主要指标如下：

| 评估指标 | 指标数值 | 效果评价 | 业务含义解读 |
|---------|---------|---------|------------|
| **轮廓系数 (Silhouette)** | **0.4796** | **良好 (Good)** | 样本在所属簇内的凝聚力强，类簇边界较为清晰，具有较强的分类稳定性 |
| **CH 指数 (Calinski-Harabasz)** | **293.94** | **显著 (Significant)** | 类别间的离散度远大于类别内部的离散度，证明聚类中心选择合理 |
| **DB 指数 (Davies-Bouldin)** | **0.7067** | **优秀 (Excellent)** | 数值显著小于 1，说明各簇之间的重叠度极低，分类空间互斥度高 |

**评估结论**：三个评估指标均显示聚类效果良好，类簇边界清晰，分类稳定性强，适合进行业务解读。

#### 4.2.2 最优 k 值选择

通过轮廓系数方法，测试了 k = 2 到 10 的聚类效果，最终选择 **k = 4** 作为最优聚类数，此时轮廓系数达到最高值。

#### 4.2.3 各 Cluster 关键特征统计

基于 KMeans 聚类结果（k=4），各 cluster 在关键特征上的统计如下：

**Cluster 0：高口碑·性价比经济单间**
- 房源类型：99% 为独立单间 (Private Room)
- 价格水平：清洁费均值约 -0.55（标准化值），全场最低
- 品质评分：拥有全类簇最高的综合评分
- 地理位置：分布在非核心商圈，距离中心较远

**Cluster 1：大容量·低分待改善整租房**
- 房源类型：100% 为整套房源 (Entire Home)
- 房源大小：平均可容纳超过 5 人，床位数量最多
- 价格与口碑：清洁费最高，但评分处于严重低位（-1.62）

**Cluster 2：中心区·极简落脚单间**
- 房源类型：85% 为独立单间
- 设施配置：设施数量（Amenities）全场最低
- 地理位置：距离市中心较近，交通便利

**Cluster 3：高品质·核心商圈精装公寓**
- 房源类型：100% 为整套房源 (Entire Home)
- 设施配置：提供的设施最为丰富（均值 0.45）
- 地理位置：最接近伦敦传统核心区

#### 4.2.4 可视化结果

**1. 最优 K 值选择可视化**：

![轮廓系数选择](figures/silhouette_score_k_selection_base.png)

通过轮廓系数方法，测试了 k = 2 到 10 的聚类效果，最终选择 **k = 4** 作为最优聚类数，此时轮廓系数达到最高值。

**2. PCA 降维可视化**：

![PCA降维投影](figures/pca_2d_projection_base.png)

PCA 将高维特征降维到 2 维，PC1 和 PC2 的方差解释比例在图中标注，为后续聚类提供可视化基础。

**3. KMeans 聚类结果可视化**：

![KMeans聚类结果](figures/pca_kmeans_clustering_base.png)

在 2D PCA 平面上用不同颜色标出各 cluster，直观展示了聚类结果在降维空间中的分布结构。

**4. 箱线图可视化**：

![KMeans箱线图](figures/boxplot_kmeans_base.png)

展示了各 cluster 在关键特征上的分布差异：
- 关键特征包括：可容纳人数（guests）、清洁费（cleaning_fee）、综合评分（rating_overall）、距离市中心距离（dist_to_center）
- 通过箱线图可以直观看出不同 cluster 在这些特征上的显著差异

**5. 地理位置可视化**：

![KMeans地理分布](figures/geographic_distribution_kmeans_base.png)

使用伦敦地图背景（London Boroughs），将不同 cluster 的房源以不同颜色标示：
- 基于 `latitude` 和 `longitude` 坐标绘制散点图
- 可以清晰看出不同 cluster 在地理位置上的分布模式：
  - Cluster 3 高度集中于核心区域
  - Cluster 0 和 Cluster 2 分布相对均匀
  - Cluster 1 分布较广

**6. GMM 聚类结果可视化**：

![GMM模型选择](figures/gmm_bic_aic_selection_base.png)

通过 BIC/AIC 准则选择最优组件数，最终选择 n_components = 4。

![GMM聚类结果](figures/pca_gmm_clustering_base.png)

GMM 在 PCA 降维空间中的聚类结果可视化。

![GMM箱线图](figures/boxplot_gmm_base.png)

GMM 各 cluster 在关键特征上的分布差异。

![GMM地理分布](figures/geographic_distribution_gmm_base.png)

GMM 聚类结果的地理空间分布。

#### 4.2.5 特征版本对比（选做任务）

完成了三种特征版本的对比分析：

1. **Base 版本**：只使用"静态属性 + 口碑"（规模、设施、评分）
2. **R 版本**：在 Base 基础上加入 RevPAR 表现指标
3. **OR 版本**：在 Base 基础上加入 Occupancy 表现指标

通过对比发现，加入表现指标后，聚类结果在业务解释上更加丰富，能够识别出"高收益房源"和"高入住率房源"等细分市场。

#### 4.2.6 与专业运营的关系（选做任务）

![专业运营关系分析](figures/Professional_Management_Analysis.png)

统计了不同 cluster 中 `superhost` 和 `professional_management` 的占比，结果如下：

**Superhost 占比统计**：

| Cluster | 总样本数 | Superhost数量 | Superhost占比(%) | 相对整体平均 |
|---------|---------|--------------|-----------------|------------|
| Cluster 0 | 107 | 80 | **74.77%** | +显著高于平均 |
| Cluster 1 | 35 | 5 | 14.29% | -显著低于平均 |
| Cluster 2 | 49 | 11 | 22.45% | -低于平均 |
| Cluster 3 | 109 | 57 | **52.29%** | +高于平均 |

**Professional Management 占比统计**：

| Cluster | 总样本数 | Professional Management数量 | Professional Management占比(%) |
|---------|---------|----------------------------|------------------------------|
| Cluster 0 | 107 | 0 | 0.00% |
| Cluster 1 | 35 | 1 | 2.86% |
| Cluster 2 | 49 | 0 | 0.00% |
| Cluster 3 | 109 | 3 | 2.75% |

**关键发现**：

1. **Superhost 集中度**：
   - **Cluster 0（高口碑·性价比经济单间）** 的 Superhost 占比最高（74.77%），远超其他 cluster
   - **Cluster 3（高品质·核心商圈精装公寓）** 的 Superhost 占比也较高（52.29%）
   - **Cluster 1（大容量·低分待改善整租房）** 的 Superhost 占比最低（14.29%）

2. **Professional Management 分布**：
   - 整体 Professional Management 占比极低（<3%），说明 London 市场以个人房东为主
   - 各 cluster 之间差异不明显，专业管理房源分布相对均匀

3. **业务启示**：
   - **高口碑房源与 Superhost 高度相关**：Cluster 0 和 Cluster 3 的高 Superhost 占比验证了"优质服务带来高评分"的规律
   - **个人房东模式占主导**：Professional Management 占比极低，说明 London 市场仍以个人房东为主，专业管理公司尚未大规模进入
   - **运营建议**：平台可以重点推广 Superhost 认证，帮助 Cluster 1 和 Cluster 2 的房东提升服务质量

---

### 4.3 结果分析与业务解读

#### 4.3.1 不同聚类方法的对比分析

**KMeans vs GMM**：
- 两种方法都识别出了 4 个主要细分市场
- KMeans 结果更直观，每个样本明确属于一个簇
- GMM 提供了概率分配，可以量化样本的归属不确定性
- 两种方法的结果在业务解释上高度一致，验证了聚类结果的稳定性

**业务一致性验证**：
聚类结果不仅在数学上通过了测试，在业务逻辑上也与伦敦短租市场的实际情况高度吻合：

1. **维度一：收益与地段的"金律"验证**
   - 观察结果："高价核心商圈小户型"的平均收益 (RevPAR: 0.589) 为全场最高，且其距离市中心的平均距离最短
   - 业务评价：模型准确识别出了"地段即收益"的市场规律，地段溢价能力在聚类中心得到了明确体现

2. **维度二：规模与口碑的"错位"验证**
   - 观察结果："家庭度假型大户型"拥有最高的平均载客量 (4.95人)，但其综合评分却是全场最低 (-1.492)
   - 业务评价：模型敏锐地识别出了大体量房源在清洁、维护和标准化运营上的管理痛点，与"运营地雷区"的预判逻辑一致

3. **维度三：产品形态的"纯度"验证**
   - 观察结果："商务短住型单间"簇内 99% 以上均为独立单间 (Private Room)，且评分表现最稳健
   - 业务评价：PCA 降维有效地保留了房型这一关键特征，聚类结果在房型分布上表现出极高的分类纯净度

#### 4.3.2 各 Cluster 业务画像与命名

**基于 KMeans 聚类结果（Base 版本）**：

**Cluster 0："高口碑·性价比经济单间"**
- **房源类型**：99% 为独立单间 (Private Room)，极少整套出租
- **价格水平**：全场最低。清洁费均值约 -0.55（标准化值），是预算敏感型游客的首选
- **品质评分**：评分顶尖。拥有全类簇最高的综合评分，代表了极高的房东服务水准
- **地理位置**：分布在非核心商圈，距离中心较远，但凭借"高分低价"吸引了大量长期居住的游客
- **用户画像**：预算有限但对服务品质有要求的长期居住游客

**Cluster 1："大容量·低分待改善整租房"**
- **房源类型**：100% 为整套房源 (Entire Home)
- **房源大小**：空间最大。平均可容纳超过 5 人，床位数量最多，适合大型团体
- **价格与口碑**：高价低分。清洁费最高，但评分处于严重低位（-1.62），存在明显的卫生或管理隐患
- **业务建议**：此类房源属于"地雷区"，急需运营优化或设施翻新，否则极易产生客诉

**Cluster 2："中心区·极简落脚单间"**
- **房源类型**：85% 为独立单间
- **设施配置**：极简主义。设施数量（Amenities）全场最低，仅满足基本睡眠需求
- **地理位置**：地段优越。距离市中心较近，交通极其便利
- **用户画像**：适合只需在中心区短暂停留、对设施要求极低、对价格和位置敏感的年轻背包客

**Cluster 3："高品质·核心商圈精装公寓"**
- **房源类型**：100% 为整套房源 (Entire Home)
- **设施配置**：顶配精装。提供的设施最为丰富（均值 0.45），装修档次高
- **地理位置**：地段王者。地理位置最接近伦敦传统核心区（特拉法加广场附近）
- **用户画像**：高净值商务人士、追求品质的家庭游客首选，拥有稳健的口碑和较高的溢价能力

**基于 GMM 聚类结果（Base 版本）**：

**Cluster 0："口碑驱动型·大众高性价比房源"**
- 评分水平：拥有全样本中最高的平均评分（均值 0.60）
- 价格水平：清洁费水平为全场最低（均值 -0.57）
- 房源大小：空间配置均衡，平均可容纳 3.8 人

**Cluster 1："大型度假型·高维护风险房源"**
- 房源大小：拥有全场最大的载客量（平均容纳 5.26 人）
- 价格水平：清洁费水平处于全场最高位（均值 0.79）
- 评分水平：评分表现最差（均值 -1.33）

**Cluster 2："边缘地带型·基础保障房源"**
- 设施水平：便利设施数量最少（均值 -0.73）
- 评分水平：评分偏低（均值 -0.73）
- 地理位置：多分布于城市边缘或偏远行政区

**Cluster 3："精品商务型·全配套核心房源"**
- 设施水平：便利设施最为丰富（均值 0.36）
- 地理位置：高度集中于伦敦核心区域（一区、西区）
- 房源大小：户型最紧凑（载客量 3.58 为全场最小）

#### 4.3.3 业务决策建议

基于聚类分析结果，对房东和平台提出以下可操作建议：

**1. 运营提升建议**：
- **针对"大容量·低分待改善整租房"（Cluster 1）**：
  - 应重点引入专业化清洁与维护流程
  - 由于其容纳能力具有规模效应，只要评分回归平均线，其 RevPAR 仍有巨大增长空间
  - 建议平台提供运营支持服务，帮助改善管理质量

**2. 模式复制建议**：
- **针对"高口碑·性价比经济单间"（Cluster 0）**：
  - 模式的标准化程度高且用户反馈极好
  - 适合作为品牌化连锁经营的蓝本
  - 可以在其他非核心区域快速复制

**3. 定价策略建议**：
- **针对"高品质·核心商圈精装公寓"（Cluster 3）**：
  - 利用聚类标签，实施更高的动态价格策略
  - 在旅游旺季可以适当提高价格
- **针对"边缘地带型·基础保障房源"（Cluster 2）**：
  - 推出长租折扣以提高出租率
  - 通过价格优势弥补地理位置劣势

**4. 市场定位建议**：
- 平台可以根据聚类结果，为不同细分市场制定差异化的运营策略
- 对于高收益细分市场（Cluster 3），可以重点推广和资源倾斜
- 对于高风险细分市场（Cluster 1），需要加强质量监管和运营支持

**5. 专业运营关系分析**（选做任务）：
- **Superhost 集中度**：Cluster 0（高口碑·性价比经济单间）和 Cluster 3（高品质·核心商圈精装公寓）的 Superhost 占比显著高于其他 cluster，验证了优质服务与高评分的正相关关系
- **专业管理现状**：Professional Management 占比极低（<3%），说明 London 市场仍以个人房东为主，专业管理公司尚未大规模进入
- **平台启示**：
  - 可以重点推广 Superhost 认证，帮助低评分 cluster 的房东提升服务质量
  - 对于 Cluster 1（大容量·低分待改善整租房），可以引入专业管理服务，改善运营质量
  - 专业管理公司可以重点关注 Cluster 3（高收益细分市场），通过规模化运营获得更高收益

---

## 5. 结论与不足

### 5.1 主要结论

基于对 London 房源数据的聚类分析，本项目得出以下主要结论：

1. **成功识别出 4 个主要细分市场**：
   - 通过 KMeans 和 GMM 两种方法，均识别出了 4 个具有明显差异的房源细分市场
   - 聚类质量评估指标（轮廓系数 0.4796，DB 指数 0.7067）显示聚类效果良好

2. **不同细分市场的关键特征**：
   - **高口碑性价比型**：低价格、高评分、单间为主，适合预算敏感型长期居住游客
   - **大容量高风险型**：大户型、高价格、低评分，存在明显的运营管理问题
   - **中心区极简型**：地理位置优越、设施简陋、适合短期停留的背包客
   - **核心商圈精品型**：高配置、黄金地段、高收益，适合高净值商务人士

3. **最佳聚类方案**：
   - 使用 KMeans（k=4）和 GMM（n_components=4）两种方法
   - 通过轮廓系数和 BIC/AIC 准则选择最优参数
   - 两种方法结果高度一致，验证了聚类结果的稳定性
   - 聚类质量评估指标均显示效果良好

4. **业务价值发现**：
   - 验证了"地段即收益"的市场规律
   - 识别出了"规模与口碑错位"的管理痛点
   - 发现了不同产品形态的"纯度"特征
   - 为平台和房东提供了可操作的运营建议

5. **特征版本对比**：
   - 完成了 Base、R（含 RevPAR）、OR（含 Occupancy）三个版本的对比
   - 发现加入表现指标后，聚类结果在业务解释上更加丰富
   - 成功识别出"高收益房源"和"高入住率房源"等细分市场

---

### 5.2 不足与改进方向

**数据层面的不足**：
- 样本量相对较小（每个城市约300条），可能影响聚类稳定性
- 部分字段缺失比例较高（如 bedrooms, guests 等），虽然已处理但可能影响特征质量
- 缺乏时间序列信息，无法分析市场动态变化

**方法层面的不足**：
- 特征工程可以更深入（如构造距离市中心距离、价格分位区间等派生特征）
- 已使用 PCA 降维辅助可视化，但可以尝试 UMAP/t-SNE 等其他降维方法进行对比
- 可以尝试更多聚类方法进行对比（如层次聚类、DBSCAN 等）

**未来改进方向**：
- 增加样本量，提高聚类稳定性
- 引入更多地理特征（如距离市中心距离、交通便利度等）
- 尝试深度学习方法（如自编码器 + 聚类）
- 引入时间维度，分析市场细分的变化趋势
- 结合 NLP 技术，利用评论文本信息

---

## 6. 小组协作与个人收获

### 6.1 分工与协作情况

**协作方式**：
- 使用 GitHub 私有仓库进行代码版本控制
- 通过 commit 记录跟踪每个成员的贡献
- 定期沟通，确保各模块进度协调

**分工情况**：
- **数据 & EDA 负责人**：完成数据预处理、特征工程、缺失值和异常值处理
- **模型 & 评估负责人**：负责聚类建模、结果评估、可视化
- **代码负责人**：维护项目结构、确保代码可复现性
- **报告撰写负责人**：撰写项目报告、整理结论

**协作方式**：
- **版本控制**：本项目未使用 branch 和 pull request，因为项目分工清晰，四个人的工作大都分时间顺序，极少出现一个阶段多人同时工作的情况，因此评估之后我们认为没有使用branch 和 pull request的必要。因此，所有成员直接在 main 分支上提交代码
- **分工讨论**：项目初期通过讨论确定了分工方案，并在 `notebooks/readme.md` 中详细记录了各成员的职责和任务要求。该文档明确了：
  - 数据 & EDA 负责人需要完成五个城市的数据预处理，包括特征选择、缺失值处理、异常值处理、编码和标准化
  - 模型 & 评估负责人需要检查数据质量，进行降维和聚类分析，并绘制可视化结果
  - 报告撰写负责人需要仔细阅读前两位负责人的说明文档，确保报告内容符合实际工作
- **意见分歧处理**：通过直接沟通和文档记录的方式解决，确保各成员明确自己的任务边界和交付要求
- **GitHub 提交记录截图**：见下方

![GitHub提交记录1](figures/git_commits1.png)

![GitHub提交记录2](figures/git_commits2.png)

---

### 6.2 个人收获（每人 3–5 句话）


- **李兴业（数据 & EDA 负责人）**：
  在本课题中，我主要负责多城市 Airbnb 原始数据的清洗、整合与探索性分析工作。通过统一特征选择、缺失值填补、异常值裁剪、类别变量编码及输出结构，我保证了不同城市数据在语义和尺度上的一致性，为后续聚类分析提供了稳定的数据基础。在处理过程中，我更加关注数据处理的统计合理性，例如避免将关键规模变量的缺失值简单填为 0，并对偏态明显的变量进行异常值裁剪，以减少其对无监督学习结果的干扰。同时，通过对高维类别与设施信息的合理简化，我体会到数据预处理本身对聚类可解释性和可复用性具有重要影响。

- **林华宝（模型 & 评估负责人）**：
  我主要负责聚类建模这部分，说实话一开始拿到处理好的数据还有点懵，因为特征维度挺高的。后来用了PCA降维，把数据降到2维方便可视化，这个过程中对降维的理解更深了。然后就是尝试KMeans和GMM两种方法，KMeans比较简单直接，GMM用BIC/AIC选组件数这个思路挺有意思的。画地理分布图的时候遇到了geopandas的问题，折腾了好久才搞定，但最后看到地图上不同颜色的聚类结果还是挺有成就感的。整体来说，这次项目让我对无监督学习有了更实际的认识，不再是纸上谈兵了。

- **黄江善（代码负责人）**：
  我的工作主要是维护项目结构和代码的可复现性。刚开始的时候代码比较乱，每个人写的风格也不一样，后来统一了一下代码格式和文件组织方式。在整合代码的过程中，发现了一些bug，比如工作目录的问题，还有编码问题导致图中生成的的乱码，这些都得一个个解决。另外就是写了一些工具脚本，比如三个不同数据集下的一次性运行所有代码的脚本，以及最后整合多个数据集+WebGUI的脚本，让整个流程更顺畅，以及提供更好的展示可视性。同时我还负责了展示PPT的制作。通过这个项目，我意识到代码规范化和可复现性真的很重要，不然别人（包括未来的自己）根本跑不起来。

- **孙榕泽（报告撰写负责人）**：
  我负责写报告，但其实写报告之前得先把整个项目理解透。我花了不少时间看队友的代码和说明文档，特别是数据预处理那部分，因为要准确描述他们做了什么。写报告的过程中发现有些地方不太清楚，就得去问队友，比如为什么选这些特征，为什么用这些方法。最头疼的是要把技术细节用比较通俗的语言表达出来，还要有业务解读，这个平衡挺难把握的。不过写完整个报告后，对整个项目的理解确实加深了很多，也学会了怎么把技术工作转化成文字表达。

---

## 7. 附录

### 7.1 主要代码结构说明

```
ml-course-project-2025-kaggle/
├── data/                    # 数据目录
│   └── README.md           # 数据说明文档
├── notebooks/               # Jupyter Notebook（用于探索性分析）
│   ├── readme.md
│   └── Project Description.md
├── projects/               # 课题说明文档
│   └── project3_clustering_market_segmentation.md
├── reports/                # 报告目录
│   ├── report_template.md  # 报告模板
│   └── final_report.md     # 最终报告（本文档）
├── src/                    # 源代码目录
│   ├── PCA-London/          # London 数据集PCA降维+两种聚类脚本
│   ├── Londonlistingdata.py      # London 数据处理脚本
│   ├── Tokyolistingdata.py       # Tokyo 数据处理脚本
│   ├── Parislistingdata.py       # Paris 数据处理脚本
│   ├── Seoullistingdata.py       # Seoul 数据处理脚本
│   ├── Rio de Janeiro_listings.py # Rio 数据处理脚本
│   ├── main.py             # 主程序入口
│   └── Web_demo_GUI.py     # Web 界面脚本
├──outputs/                 # 输出目录
|   └──figures/             # 图片保存目录
├── README.md               # 项目总说明
└── requirements.txt        # Python 依赖
```

### 7.2 关键函数/脚本说明

**数据处理脚本**（`src/*listingdata.py`）：
- 功能：读取原始数据，进行特征选择、缺失值处理、异常值处理、编码、标准化
- 输入：原始 CSV 文件（`data/*_listings.csv`）
- 输出：处理后的三个版本 CSV 文件（base, with_revpar, with_occupancy）

**运行方式**：
```bash
python src/main.py

```

### 7.3 运行项目的简要步骤

1. **安装依赖**：
   ```bash
   pip install -r requirements.txt
   ```

2. **数据准备**：
   - 从网盘下载原始数据（见 `data/README.md`）
   - 将数据文件放置在 `data/` 目录下

3. **数据预处理**：
   - 运行各城市的数据处理脚本
   - 生成处理后的 CSV 文件

4. **聚类建模**：
   - 运行聚类脚本
   - 生成聚类结果和可视化图表

5. **报告撰写**：
   - 基于本文档补充完整内容

### 7.4 额外图表与补充分析

本项目已完成以下可视化图表和分析：

1. **PCA降维可视化**：展示了高维特征降维到2维后的分布，方差解释率清晰可见
2. **KMeans聚类分析**：包括轮廓系数选择、聚类结果可视化、箱线图分析和地理分布图
3. **GMM聚类分析**：包括BIC/AIC模型选择、聚类结果可视化、箱线图分析和地理分布图
4. **专业运营关系分析**：分析了superhost和professional_management在各cluster中的分布，揭示了专业管理在不同市场细分中的作用

所有图表已保存在 `outputs/figures/` 目录下，并在报告4.2节中进行了详细说明和业务解读。通过这些可视化分析，我们能够清晰地识别出4个不同的房源市场细分，并为每个细分市场提供了业务可理解的命名和特征描述。

---

**报告完成日期**：2026.1.8
**最后更新**：2026.1.8




